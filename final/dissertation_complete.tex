%\documentclass[a4paper,12pt,]{report}
%\usepackage[left=3cm,right=1.7cm,bottom=2cm,top=2.2cm]{geometry}
\documentclass[a4paper,12pt,twoside]{report}
%\usepackage[DIV=20,BCOR=30mm,headinclude=true,footinclude=false]{typearea}
\usepackage[left=2.5cm,right=1.7cm,bottom=2cm,top=2.2cm]{geometry}

% Page and title setup
\usepackage{setspace}
\setstretch{2}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead[CO,CE]{\leftmark}
\fancyhead[LO,LE]{SOEE3058}
\fancyhead[RE,RO]{200695089}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
\usepackage{titlesec}
\titleformat{\chapter}[display]
  {\normalfont\bfseries\vspace{-4.0cm}}{}{0pt}{\Huge}
\setcounter{secnumdepth}{2}
\usepackage[toc,page]{appendix}
\usepackage{pdfpages}
\usepackage{afterpage}

% font
\usepackage{charter}    

% references
\usepackage{natbib} 
\bibliographystyle{leedsHarvard}  
\renewcommand\bibname{References}
\usepackage[nottoc,numbib]{tocbibind}
  
% graphics and figures
\usepackage[font=it]{caption}
\usepackage{chngcntr}
\counterwithin{figure}{chapter}
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{graphicx}
\graphicspath{{/nfs/see-fs-01_teaching/ee12lmb/project/doc/figures/}}
\usepackage{tabularx}
\usepackage{tabulary}
\setlength\extrarowheight{10pt}

% program listings
\usepackage{float}
\newfloat{program}{thpb}{lop}
\floatname{program}{Listing}

\usepackage{color}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\usepackage{listings}
\lstset{language=Matlab,basicstyle=\small,keywordstyle=\color{black}\bfseri
es\underbar,
%identifierstyle=\color{red},
stringstyle=\ttfamily,
showstringspaces=false,
numbers=left, stepnumber=1,numberstyle=\tiny\color{gray},
keywordstyle=\color{blue},
commentstyle=\color{dkgreen},
stringstyle=\color{mauve},
morekeywords={m_indexDisc,m_indexCont,j_index}}

% equations
\usepackage{mathtools}  
\usepackage{amsmath}
\numberwithin{equation}{chapter}

% title etc
%\title{\textbf{The M-index: A useful metric for rock deformation?}}
%
%\author{Student: Lewis Bailey\\Student number: 200695089\\Supervisor: Dr Andrew Walker}
%\date{}


\begin{document}
% -----------    D o c u m e n t     ------------
\includepdf[pages={1-}]{titlepage/title.pdf}
%\maketitle
%\begin{titlepage}
%	\centering
%	\includegraphics[width=\textwidth,trim={3.2cm 10cm 0 0},clip]{../figures/poles_olivine_example.pdf}\par\vspace{1cm}
%    \huge{\textbf{The M-index: A useful metric for rock deformation?}}\par
%    \vspace{1cm}
%    {\Large \textit{Lewis Bailey\\Student ID: 200695089}\par}
%
%	\vspace{1.5cm}
%
%
%    {\scshape\LARGE University of Leeds \par}
%	%\vspace{1cm}
%	{\Large Submitted in accordance with the requirements of the degree of Bachelor of Geophysical Sciences.\par}
%	%\vfill
%	%\vspace{2cm}
%	%\begin{
%	Supervised by Dr.~Andrew \textsc{Walker}
%	%\end{Small}
%
%	\vfill
%
%% Bottom of the page
%
%\end{titlepage}

%TC:ignore
\pagenumbering{roman}
%\newpage\mbox{}\newpage

\vspace{3cm}
\begin{center}
{\huge The M-index: A useful metric for rock deformation?}
\vspace{3cm}

\begin{Large}
\textbf{Acknowledgements}
\end{Large}

I would like to thank my supervisor Dr Andrew Walker for valuable discussions, and meetings that always lasted as long as they needed to. I would also like to thank my coursemates and lecturers, who have made this course enjoyable and engaging from start to finish.
  
\vspace{3cm}
\noindent
\begin{Large}
%\textbf{Statement of academic integrity}
\end{Large}

This dissertation is submitted in accordance with the requirements of the degree of Bachelor of Geophysical Sciences (BSc). The candidate confirms that the work is his own, and that credit has been given where reference has been made to the work of others. 


\vspace{1cm}
\noindent
Signed: .............................................. [Lewis Bailey] Date: 

\end{center}
%TC:endignore


\begin{abstract}
\addcontentsline{toc}{chapter}{Abstract}
I created a \texttt{Matlab} toolbox to aid in quantitative texture strength analysis by allowing calculation of three texture strength indices using both viscoplastic self-consistent (VPSC) numerical models, and orientation data collected by electron backscatter diffraction (EBSD) from field samples as input. Using this toolbox I analysed the affect of calculation parameters, such as the number of grains $n$, on the value of the texture index (J-index), and the continuous and discrete M-indices. I found that for convergence for all indices, the number of grains required is $n \approx$ 1,000 or greater, which also results in a standard deviation close to zero. I found the impact of bin size on the discrete M-index to be significant, with reduction from 3$^\circ$ to 0.25$^\circ$ resulting in a $\sim$50\% difference in index value. I determined the indices as a function of strain for olivine, quartz and post-perovskite using VPSC models, and found that in general the indices increase monotonically with strain, although a numerical issue causes the discrete M-index to be multivalued in the quartz case. I used these relationships to predict strain for EBSD datasets. Finally I establish a relationship with two elastic anisotropy indices with strain, and in turn to the texture indices. 
\end{abstract}

\tableofcontents
\listoffigures
\listoftables



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Introduction} \label{chap:intro}
\vspace{-1cm}
\pagenumbering{arabic}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%---------------------------------------------------------------------------
\section{Background and motivation} \label{sec:background}
%---------------------------------------------------------------------------
In a number geological settings on Earth, processes occur that cause rocks to deform in a ductile manner in reaction to external forces (stress). Ductile deformation of rocks on short time-scales generally requires stresses greatly exceeding those on Earth. However, due to the polycrystalline nature of rocks, slow, permanent deformation is possible when stresses are maintained on geological time scales \citep{Weiss1985}. It is processes occurring at the crystal/grain scale, such as dislocation glide and dislocation creep that allow this deformation to take place, and the strain imposed to be accommodated \citep{Ashby1972}. During these processes, dislocations on the atomic scale move through the crystals on planes and directions determined by the crystal structure (slip systems), which constrains movement of crystals to rotate and become aligned as the rock is strained \citep{Goulding2015}. Therefore these internal deformation mechanisms result in what is known as crystallographic, or lattice, preferred orientation (CPO/LPO) whereby the crystal lattices within a rock become aligned \citep{Price1985}.   

The orientation of crystals within a material is often referred to as a texture, and in the field of quantitative texture analysis many methods, both mathematical and pictorial, exist to describe the important features of these textures \citep[for introductory texts see][]{bunge1982texture,Bunge1985,Randle2000,Mainprice}. Quantifying the magnitude or strength of LPO is important in material science as properties of most crystals are anisotropic, and alignment of these individually anisotropic crystals can average to affect bulk properties up to 20\% - 50\% \citep{Randle2000}. In addition, and more specifically to Earth sciences, texture strength gives insights into deformation history and regimes that a rock has been subjected to, as texture strength is often strongly related to the intensity of deformation \citep{Weiss1985}.

For example, elastic anisotropy of crystals in rocks can lead to bulk seismic anisotropy in the presence of LPO, as the seismic properties of an aggregate can be calculated as the average of its component crystals \citep{Tommasi1999}. LPO of olivine is thought to be integral to the seismic anisotropy exhibited in the upper mantle, which in turn is linked to many aspects of deformation and likely to the dynamics of mantle convection. As such, linking the strength of olivine LPO to strain is vital to understand these mechanisms \citep[e.g.][]{Warren2008}. Studies such as \cite{Tommasi2000} use forward numerical models to predict LPO strength, and hence seismic anisotropy, for a range of deformation mechanisms. If these relationships can be established then seismic data could provide information regarding LPO strength and therefore the deformation mechanisms that created this texture \citep[see][for details of a number of other approaches to this problem]{Blackman2002}. Similarly, deep within the Earth the D\rq\rq{} layer \citep{Garnero2008} above the core-mantle boundary is a region known to show high seismic anisotropy, likely caused by the large strain deformation of post-perovskite expected to occur there. Quantifying texture strength as a function of strain would aid understanding of this region, which likely influences mantle convection and thermal structure of the Earth \citep{Miyagi2010}. 

Closer to the Earth's surface, studying LPO strength can give insight into processes that have occurred in deformed regions such as shear zones and other tectonic units. \cite{Unzog2000} use LPO to study a number of properties of a transpressional collision zone in Eastern Egypt, such as deformation geometry and finite strain, and \cite{Lloyd2004} analyses LPO to determine microstructural evolution of shear zones. LPO strength is strongly linked to strain history, for quartz and many other minerals, and can therefore be used to interpret aspects of the rock's deformation history \cite{Price1985}.

It is clear from these examples that the LPO strength, and particularly its relationship with strain, is vitally important in a number of geological and geophysical settings \citep[and many more besides, see][for more examples]{Wenk1999}. The inherent three-dimensional nature of textures makes their strength difficult to quantify with a single number \citep{Schaeben2007}. However, there exists a number of indices that attempt to do this \citep[e.g. the texture index][]{bunge1982texture}, including a recent proposal by \cite{Skemer} for a misorientation index. Aside from the importance of quantifying texture strength, \cite{Skemer} provide more direct motivation for this study, calling for further research \lq\lq{}to confirm the M-index's validity or practicality for other materials\rq\rq{}. To confirm its validity, it is also necessary to compare the M-index with a number of other metrics in a similar fashion to \cite{Mainprice}, but with greater detail and for a number of crystal structures. This leads to the main aims and objectives of this study.   
   

%The study of textures and their strength has a number of applications in both industry and academia. Textures, or lattice preferred orientations (LPO) arise in rocks that have undergone ductile deformation. The properties of this LPO are dependant on the strain history, and in general increased strain leads to a \lq{}stronger\rq{} LPO \textbf{REF?}. If LPO strength can be quantified by a texture index, and this index can be reliably related to strain, then it could prove a useful tool in determining strain in situations where it is impossible to measure though conventional means.
%
%This is especially applicable to mantle studies. Relating the formation and strength of textures in peridotites to shear strain is important, as this gives insight into how deformation mechanisms lead to seismic anisotropy \citep{Warren2008}. Understanding these processes is key in determining upper mantle convection through seismic anisotropy studies \citep[e.g.][]{Blackman2002}. A metric that can act as a proxy for texture strength would be beneficial to mantle studies, as most peridotites lack strain markers \citep{Tommasi2000}.
%
%In addition to estimating strain from samples, texture indices could also offer a method of indirectly determining strain and other properties of textures via seismology. \cite{Tommasi1999} study the relationship between seismic anisotropy and LPO in continental deformation zones. They predict textures of olivine after undergoing various deformation types found in the mantle, and from this calculate the expected seismic anisotropy. If the remotely measured anisotropy can be related to texture strength (i.e. a texture index) and this index can be related to an amount of strain the material has experienced, it could provide at least an estimate of strain for remote regions of the Earth's interior. In essence this is the reverse of the processes used by \cite{Tommasi1999}. Although their study was applied to the mantle, seismic anisotropy due to LPO is known to exist in other regions of the Earth, and these have been studied using VPSC modelling \citep[e.g.][]{Wenk1999}.   
%
%Aside from these general applications, a more direct motivation arises from \cite{Skemer}. After introducing their metric (the M-index) and applying it to olivine, they state that \lq\lq{}further research is necessary to confirm the M-index's validity or practicality for other materials\rq\rq{}, which gives clear scope for a project to investigate this. In order to confirm its validity, it is also necessary to compare the M-index with a number of other metrics in a similar fashion to \cite{Mainprice}, but with greater detail and for a number of crystal structures. This leads to the main aims and objectives of this study.   




%---------------------------------------------------------------------------
\section{Aims and objectives} \label{sec:aims+objs}
	
The aim of this study is to investigate a number of methods for quantifying the strength of textures in rocks, and whether this quantification can be reliably linked to the strain of a given sample. To achieve this, I will create a \texttt{Matlab}\footnote{MATLAB Release 2015a, The MathWorks, Inc., Natick, Massachusetts, United States} toolbox that will calculate a number of texture indices for a range of input datasets. This software will be developed as a suite of functions with the aim of creating a fully functioning toolbox that could be used for future research. As such I will develop the code following a set of scientific coding principals \citep{Wilson2014}, and use version control software Github\footnote{https://github.com} to track its development.   

Using this software, I will extend the analyses of \cite{Skemer} and \cite{Mainprice} to include additional minerals. I will investigate the effect of a range of calculation parameters on the index values to determine the robustness of each index. Following this, I will analyse the validity of using these indices as a proxy for strain, using any relationship discovered to estimate strain for a number of field samples. I will compare the texture indices to elastic anisotropy indices and analyse any relationship between them. This will allow me to draw conclusions as to the effectiveness of the indices, the requirements for accurate index calculation, their usefulness as a proxy for strain and any further uses that may arise.  

In the following chapter I cover the necessary theory of textures which leads to the theory behind the indices. I begin Chapter \ref{chap:methods} by describing the available data sources and the methods of modelling/collecting this data. In the rest of the chapter, I focus on how the theory is implemented, using this data, via a suite of \texttt{Matlab} functions. As the software is an integral part of this project, I provide details on a number of key functions, the use of the software, and important aspects of its development. Once the data and methodology are in place, in Chapter \ref{chap:analysis} I present the subsequent analysis of the indices. This analysis focuses on parameters affecting index calculation \emph{(index robustness)} and their relationship with strain \emph{(proxy for strain)}. In Chapter \ref{chap:discussion} I offer a discussion of the results presented in Chapter \ref{chap:analysis} as well as suggestions for future work. Finally I summarise the findings of this study in Chapter \ref{chap:conclusion}.   
%---------------------------------------------------------------------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Theory} \label{chap:theory}
\vspace{-1cm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
In the following sections I aim to give enough theoretical knowledge of textures and the methods of computing texture strength, to allow understanding of the implementation and analysis that follows. \emph{\textbf{NB:} The material in this section is covered by a number of textbooks, namely \cite{bunge1982texture}, \cite{Bunge1985} and \cite{Randle2000}, and review papers e.g. \cite{Mainprice}}.


%---------------------------------------------------------------------------
\section{Textures in rocks} 
%---------------------------------------------------------------------------
A polycrystalline material is composed of many individual crystals (although often not all the same type), within which atoms are arranged in periodic, three dimensional lattices, each with their own orientation. Metals and rocks are examples of extensively studied polycrystalline materials. Polycrystalline aggregates can deform in a ductile manner --- in rocks this occurs when stresses are applied for geologically significant timescales. This slow, plastic deformation occurs through processes within the crystal such as dislocation creep \citep{Ashby1972},  whereby imperfections in the crystal lattice move along certain planes defined by the crystal structure (slip systems). These slip systems allow strain to be accommodated from the imposed stresses, and results in a rotation of crystals \lq\lq{}much as a tilted row of books on a shelf rotates\rq\rq{} when pushed down \citep{Goulding2015}. It is the orientation of all the crystals within a sample that make up its \emph{texture}, which is considered \lq{}stronger\rq{} when most grains are in a similar alignment, and not randomly orientated (a weak texture).       


%---------------------------------------------------------------------------
\section{Describing orientations} \label{sec:orientations}
%---------------------------------------------------------------------------
The key principal behind describing the texture of a polycrystalline material is to describe the orientations of the grains within it. In the following section, I cover a number of methods of orientation description.


\subsection{Coordinate systems \& orientations} \label{subsec:coordinates}
To describe an orientation, two coordinates systems must be defined --- one for the sample $(C_S)$ and one for any individual crystal within the sample $(C_C)$. Both systems are Cartesian, with the directions of the axes chosen to represent important surfaces or directions of crystals within the sample. By disregarding their spatial locations, an orientation $(g)$ can then be defined as a rotation that maps one coordinate system on to the other such that;



\begin{equation}
C_C\ =\ g \cdot C_S\ ,
\end{equation}  
\\
where, in this case, the sample coordinate system is rotated to that of the crystal. The orientation $g$ can be described in a number of ways. The principal methods I will use are \emph{Euler angles} and \emph{rotation matrices}.


A set of Euler angles defines three rotations that transform the sample coordinate system onto the crystal coordinate system and therefore specify an orientation. I will be using the conventions of \cite{bunge1982texture}, such that the three rotations that make up the orientation are defined as $g = \{\varphi_1,\Phi,\varphi_2\}$. The angle $\varphi_1$ is the first rotation about the $Z$ axis, followed by a rotation $\Phi$ about the $X'$ axis in its new orientation, and finally $\varphi_2$ about the $Z''$ axis, in its final orientation (Figure \ref{fig:euler_angles}). The order of these rotations is not interchangeable.




\begin{figure}[h!]
  \centering
    \includegraphics[width=0.6\textwidth]{euler_angles}
  \caption[Euler angle description]{Example of how the coordinate system of a sheet sample (here the $Z$ axis is in the normal direction ND and the $X$ axis is in the rolling direction RD) can be translated to that of the crystal coordinate system through three rotations $\varphi_1,\Phi,\varphi_2$. From \cite{Randle2000}.}
  \label{fig:euler_angles}
\end{figure}

Having established a method to describe an orientation (i.e. the rotation that maps sample to crystal coordinate systems or vice versa), so too can it describe a misorientation. A misorientation is defined as the rotation that maps one crystal's orientation onto another crystal's, rather than to the sample coordinate system. This can be described for two orientations, $g_1$ and $g_2$ such that the misorientation between them $\tilde{g}$ is;

\begin{equation} \label{eq:misor_matrix}
\tilde{g} = g_1^{-1}g_2\ .
\end{equation} 

This notation for the misorientation becomes clearer with the introduction of an \emph{orientation matrix}. This is a nine element square rotation matrix constructed in the following way. Consider a crystal coordinate system $C_c = \{X_c,Y_c,Z_c\}$ and a sample coordinate system $C_s = \{X_s,Y_s,Z_s\}$. Then define angles between axes as follows;
\begin{table}[t!]
    \centering
	\begin{tabular}{c | c c c}

	  & $X_s$      & $Y_s$      & $Z_s$ \\
\hline
$X_c$ & $\alpha_1$ & $\beta_1$ & $\gamma_1$ \\
$Y_c$ & $\alpha_2$ & $\beta_2$ & $\gamma_2$ \\
$Z_c$ & $\alpha_3$ & $\beta_3$ & $\gamma_3$ \\

	\end{tabular}
\end{table}
\\
\\
\\
\\
\noindent
and so construct the matrix;

\begin{equation}
g = 
\begin{pmatrix}
g_{11} & g_{12} & g_{13} \\
g_{21} & g_{22} & g_{23} \\
g_{31} & g_{32} & g_{33} \\
\end{pmatrix}
= 
\begin{pmatrix}
cos \alpha_1 & cos \beta_1 & cos \gamma_1 \\
cos \alpha_2 & cos \beta_2 & cos \gamma_2 \\
cos \alpha_3 & cos \beta_3 & cos \gamma_3 \\
\end{pmatrix}\ .
\end{equation}
\\
This matrix is a useful tool in describing rotation and symmetry operations (see Appendix \ref{App:symp_ops}) because the result of two or more rotations can be expressed by matrix multiplication, adding clarity to the definition of the misorientation matrix defined in equation \ref{eq:misor_matrix}. In addition, a set of Euler angles can be converted to an orientation matrix (see Appendix \ref{App:M-index_calc}). Due to orthogonality $g^{-1} = g^T$. 


In addition to Euler angles and rotation matrices, another method for describing the orientation of a crystal, or any number of crystals, in a sample is through the use of \emph{pole figures}. An orientation of an arbitrary crystal face (chosen to best represent the crystal structure) can be described by a vector normal to its surface. This vector, or pole, then corresponds to a point on a unit reference sphere centred on the crystal (Figure \ref{fig:spherical_orientation}). The reference sphere is attached to the sample coordinate system, allowing two angles (the azimuth $\alpha$ and the rotation around the pole axis $\beta$) to represent the orientation of the crystal with respect to that frame.  




\begin{figure}[h!]
  \centering
    \includegraphics[width=0.6\textwidth]{pole_figure}
  \caption[Pole figure visualisation]{Orientation of the basal (0001) plane in a hexagonal crystal. Projecting the orientation on the reference sphere requires two angles, $\alpha$ and $\beta$. In this example, the crystal still has freedom to rotate about the 0001 axis, so more information is required (the $\mathit{10\overline{1}0}$ pole) to describe the orientation in three dimensions. From \cite{Randle2000}.}
  \label{fig:spherical_orientation}
\end{figure}



To represent this three dimensional orientation in two dimensions, these poles must be projected onto a two-dimensional plane --- this is done using either stereographic or equal-area projection. By choosing an axis of the sample coordinate system to be the north pole (typically $Z$) so that $\alpha = 0^\circ$ requires the normal of the plane in question to be parallel to that axis. The poles can then be projected as in Figure \ref{fig:pole_olivine_example}, which shows an example of pole figures for a simulated olivine sample. Here the density of poles is plotted as a colour intensity. The Miller indicies above the figures show which crystal axes are being considered for each relevant pole figure. In the case of olivine and its orthorhombic crystal shape, the poles of three crystal faces are needed to unambiguously describe its orientation. Any less than this and the crystal has a degree of freedom to rotate, as in Figure \ref{fig:spherical_orientation}. The number of poles required to unambiguously describe an orientation depends on the crystal symmetry.




\begin{figure}[h]
  \centering
    \includegraphics[width=0.85\textwidth,trim={3.2cm 10cm 0 0},clip]{poles_olivine_example}
  \caption[Pole figure olivine example]{Example of pole figures for a modelled olivine sample. The Miller indices are displayed above the the lower hemisphere projections, with red colours indicating a higher density of poles plotted.}
  \label{fig:pole_olivine_example}
\end{figure}

A pole figure represents the orientation of the crystal coordinate system in the sample coordinate system, the opposites is known as the inverse pole figure. In addition to pole figures, other methods of describing orientations exist such as quaternions \citep{Quaternions}. However these are beyond the scope of this project. 

\subsection{Orientation distribution functions} \label{subsec:ODFs}
To perform quantitative analysis of a texture, a two-dimensional pole figure does not contain enough information---a three-dimensional \emph{orientation distribution function} (ODF) is required. Unlike pole figures, ODFs cannot be measured experimentally, they must be calculated from pole figure data. Recalling that a pole direction can be defined by two angles $\alpha$ and $\beta$ in a pole figure $P_h(y)$, this then corresponds to a region in the ODF which contains all the rotations $\gamma$ about this direction $y$. This results in the following equation;

\begin{equation} \label{eq:pole_figures}
P_h(y) = \frac{1}{2\pi} \cdot \int_{0}^{2\pi}f(g)\ \mathrm{d}\gamma;\ ,
\end{equation}
\\
where $f(g)$ is the ODF, with $g = \{\varphi_1,\Phi,\varphi_2\}$. In a similar way an inverse pole figure equation can also be derived. As pole figures are two-dimensional projections, multiple pole figures are needed to unambiguously describe the three-dimensional ODF \citep[and in fact it is only determined uniquely for an infinite number of pole figures,][]{Bunge1985}.

Solving this equation is an inverse problem known as pole figure inversion, for which no analytic solution exists. One method for approximating the ODF is through spherical harmonic series expansion, such that;

\begin{equation} \label{eq:series_exp}
f(g) = \sum_{l=0}^{l_{max}} \sum_{m=-l}^l \sum_{n=-l}^l C_l^{mn} T_l^{mn} (g) \ ,
\end{equation}
\\
where $T_l^{mn}$ are spherical harmonic functions and $C_l^{mn}$ are expansion coefficients to be determined. Full description of this method and other, more direct methods is beyond the scope of this project (for more general information see relevant chapters in \cite{bunge1982texture,Bunge1985} and \cite{Randle2000}, or for information regarding the methods used in this project see \cite{Hielscher2008}).

Pole figure inversion deals with the practicality of obtaining an ODF from experimental pole figure data. However, \cite{bunge1982texture} offers a more intuitive description. Firstly the spatial location of the crystals in the sample can be disregarded, and only their orientations $g = \{\varphi_1,\Phi,\varphi_2\}$ are considered. The ODF is then defined as the fraction of crystals \emph{of the same phase} that have the orientation $g$ within an infinitesimal orientation element $\mathrm{d}g$ (in Euler space) such that: 



\begin{equation}
\frac{\mathrm{d}V(g)}{V} = f(g)\ \mathrm{d}g\ ,
\end{equation}
\\
where $f(g)$ is the ODF, and $V$ is the total sample volume. \cite{Mainprice} state that a \emph{mis}orientation distribution function (MDF) can be defined for a misorientation $\tilde{g}$ in a similar way;




\begin{equation}
\frac{\mathrm{d}V(\tilde{g})}{V} = f_{MDF}(\tilde{g})\ \mathrm{d}\tilde{g}\ ,
\end{equation}
\\
where $\mathrm{d}V(\tilde{g})/V$ is now the fraction of misorientations in the sample. In essence the ODF and MDF are statistical in nature as they are probablity density functions of orientations $g$ or misorientations $\tilde{g}$. 


%---------------------------------------------------------------------------
\section{Texture indices} \label{sec:indicies}
%---------------------------------------------------------------------------
Having established a mathematical way of describing the orientations of grains within a sample (the ODF/MDF, or a \emph{texture function}), the next step is to find a method of quantising the \lq{}sharpness\rq{} or strength of this function, and hence the strength of the texture.

\subsection{J-index} \label{subsec:j-index}
 One of the most widely used indicies is the texture index $J$, as described by \cite{bunge1982texture} to be the integral of the square of the texture function,

\begin{equation}
J = \int [ f(g) ]^2\ \mathrm{d}g \ ,
\end{equation} 
\\
where the infinitesimal volume element in Euler angle space $\mathrm{d}g$ is given by:

\begin{equation}
\mathrm{d}g = \frac{1}{8\pi^2} \sin\Phi\ \mathrm{d}\Phi\ \mathrm{d}\varphi_1\ \mathrm{d}\varphi_2\ .
\end{equation} 
\\
This definition is true for both $f_{ODF}$ and $f_{MDF}$, the difference only being the definition of $g$ (see Section \ref{subsec:coordinates}). The texture index $J$ is more removed from physical meaning than the M-index (see following section), but as the texture function $f(g)$ is a statistical representation of the physical texture, calculating its magnitude (in this case the $L^2$ norm $||f||^2_{L^2}$) gives information about its strength.

To put the texture index in context it is useful to compare with another measure, the entropy $S$ of the texture function:

\begin{equation}
S\ =\ -\int f(g)\ ln f(g)\ \mathrm{d}g\ ,
\end{equation}
\\
introduced by \cite{Schaeben1988}. The entropy essentially measures the deviation from the uniform ODF \citep[lack of \lq{}organisation\rq{} of orientations,][]{Hielscher2007}. Due to the $ln f(g)$ term, $S$ is sensitive to very small values of the texture function. In some sense, the texture index $J$ is the opposite, as it is a measure of concentration rather than dispersion of orientations. As it includes the square of the texture function $[f(g)]^2$, it is more sensitive to large values, (i.e. peaks) in the function \citep{Mainprice}. For more discussion on the relation between $J$ and $S$ see \cite{Hielscher2007}. 

It can be shown that for a random texture $J_r = 1$. In addition, if the sample is a perfect single crystal, then the texture changes at only one point $g = g_0$, which results in $J_{ideal} \to \infty$ \citep{bunge1982texture}, leading to:

\begin{equation}
1 \leq J_{ODF} \leq \infty\ .
\end{equation}
\\
$J_{MDF}$ will not tend to $\infty$ but rather a maximum value \citep{Mainprice}.

In a nearly identical way, and by recalling the definition of pole figures (equation \ref{eq:pole_figures}) the $J$ index for a pole figure can be defined as:
 
\begin{equation}
J_{P_h(y)} = \frac{1}{4\pi} \int [ P_{h}(y) ]^2\ dy\ ,
\end{equation}
\\
with the same holding true for inverse pole figures. \cite{bunge1982texture} showed that $J_{P_h(y)} \leq J$. This inequality makes sense physically as the strength of texture in a pole figure cannot be greater than the strength of a texture as a whole, and can take a maximum value when the pole is aligned with the direction of the maximum texture. As this project includes a number of indices, to avoid confusion the texture index shall be referred to as the \emph{J-index}, as it is often denoted with the letter $J$.


\subsection{M-index} \label{subsec:Mindex}
A more empirical method to quantify texture strength is the M-index. Defined by \cite{Skemer}, the method is based on the difference between a measured misorientation angle distribution $f^M(\theta)$ and a random theoretic distribution $f^R(\theta)$ (calculated from the sample crystal symmetry). To understand the physical significance of this metric, it is first important to define the misorientation angle between two crystals. Recalling the definition of a misorientation matrix $\tilde{g}$ (a 3 x 3 rotation matrix that rotates one crystal coordinate system onto another), a misorientation angle $\theta$ can be extracted from this matrix using the relation:

\begin{equation} \label{eq:misorientation_angle}
\cos{\theta}\ =\ \frac{(\tilde{g}_{11} + \tilde{g}_{22} + \tilde{g}_{33} - 1)}{2}\ .
\end{equation} 
\\
\citep{Randle2000}. This is the angle needed to rotate one coordinate system about some common axis in order for the two coordinate systems (and hence the two crystals) to be aligned. Figure \ref{fig:angle-axis_example} shows an example of how an angle/axis of rotation can describe a misorientation. A misorientation angle distribution is simply a histogram detailing the frequency density of misorientation angles within the sample (the rotation vector is unimportant). There are two types of misorientation angle distributions. A correlated distribution is where only the angles between neighbouring grains are considered, whereas in an uncorrelated distribution, angles between all pairs of crystals are considered.

%---------------------------FIG---------------------------------------------   
\begin{figure}[h]
  \centering
    \includegraphics[width=0.6\textwidth]{axes_angle_rot_PPT.pdf}
  \caption[Angle/axis of rotation example]{Example of how an angle of rotation $\theta$ about a common axis \textbf{r} can translate one crystal onto another. For two cubes orientated such as this, the location and direction of the axis is obvious, but the vector \textbf{r} need not follow a crystal edge as in this example (and often will not). After \cite{Randle2000}.}
  \label{fig:angle-axis_example}
\end{figure}
%---------------------------FIG---------------------------------------------   

\cite{Skemer} define the M-index, in terms of \emph{continuous} misorientation angle distributions (i.e. derived statistically from a MDF) as:

\begin{equation} \label{eq:Mindex_cont}
M \equiv \frac{1}{2} \int | f^M(\theta) - f^R(\theta) |\ \mathrm{d}\theta \ .
\end{equation}  
\\   
The physical significance of this index is related to the change in individual misorientation angles within the sample as strain is increased. As strain increases and grains begin to align (i.e. texture strength increases), misorientation angles between any arbitrary pair of grains will become smaller, due to their coordinate systems being more closely aligned. This makes the M-index definition clearer: at low strains a sample texture will be close to the theoretical random texture and so the difference between their misorientation angle distributions will be small. As strain increases, the sample distribution will favour lower angles, and the difference between them will become greater (and therefore the index value will be larger). This is demonstrated in Figure \ref{fig:misorientation_example} showing distributions for an olivine VPSC model (see Section \ref{sec:data}) undergoing simple shear at increasing strain steps.


%---------------------------FIG---------------------------------------------   
\begin{figure}[t]
  \centering
    \includegraphics[width=\textwidth]{figs/OLV_SPS_misor_example.pdf}
  \caption[Misorientation angle distribution example (olivine VPSC)]{Misorientation angle distribution for an olivine VPSC model undergoing simple shear. The solid black line represents the expected distribution for a random texture for reference. It is clear that as stain increases from panels \textbf{(a)} to \textbf{(d)} that there is a higher frequency of lower misorientation angles (due to the grains aligning) resulting in a greater difference between the sample distribution and the random distribution.}
  \label{fig:misorientation_example}
\end{figure}
%---------------------------FIG--------------------------------------------- 

In practice the M-index is calculated using the \emph{discrete} definition whereby the difference between the theoretic and random distribution is simply the difference between the histograms:

\begin{equation} \label{eq:Mindex_disc}
M \equiv \sum_{i=1}^n | f_i^M - f_i^R | \cdot \frac{\theta_{max}}{2n}\ ,
\end{equation} 
where the calculation is now for $n$ histogram bins and $\theta_{max}$ is the maximum theoretical misorientation angle for the specific crystal symmetry \citep[for discussion on misorientation angle distirbutions for various crystal symmetries see][and references therein]{Grimmer1979,Wheeler2001}. The factor of a half is for convenience to give the range $0 \leq M \leq 1$. 

  

\cite{Schaeben2007} offers some criticism of the theoretical validity and usefulness of the M-index. In particular he does not agree with the claim of \cite{Skemer} that the M-index provides a more robust and objective measure than the J-index. He argues that calculating index values by considering each orientation as independent is statistically incorrect as the orientation measurements are spatially correlated. \cite{Skemer2007reply} have responded stating that the M-index is an alternative to the J-index and does not aim to replace it. Emphasis is placed on its use in Earth-sciences due to its apparent robustness at low numbers of measurements. Analysis of these claims by \cite{Skemer} and \cite{Skemer2007reply} forms part of the motivation for this work.  

\section{Elastic anisotropy indices} \label{sec:anisotropy_indices}

Although the texture indices are the focus of this study, another related measure is seismic anisotropy. As discussed previously, texture strength is often strongly related to seismic anisotropy as the alignment of individually elastically anisotropic crystals can result in bulk anisotropy for a given material \citep[e.g.][]{Tommasi1999,Miyagi2010}. \cite{Ledbetter2006} introduced a measure of anisotropy (lmA) that is the ratio of the square of the maximum $(v_2)$ to the square of the minimum $(v_1)$ shear velocity of a given crystal:

\begin{equation}
lmA\ =\ \frac{v_2^2}{v_1^2}\ ,
\end{equation}   
\noindent
which is calculated by considering $n$ random vectors and finding the two extrema values. \cite{Ranganathan2008} introduced a universal elastic anisotropy index (uA), which is a measure of the deviation of the stiffness coefficients from an isotropic crystal. Detailed description of the mathematics of these indices is beyond the scope of this project \citep[for full descriptions see][]{Ledbetter2006,Ranganathan2008} --- the important feature of these indices is that they are a measure of the \lq{}magnitude\rq{} of seismic anisotropy for a given crystal. To find a measure for a sample as a whole, the elastic tensors for each crystal are averaged, and the anisotropy measure calculated from this as if the sample were a single crystal. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Data and Methods} \label{chap:methods}
\vspace{-1cm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Now that the necessary theory has been established, in the following sections I provide a description of how the indices have been implemented. However, to understand the implementation it is important to first introduce the datasets from which the indices will be calculated.  

%---------------------------------------------------------------------------
\section{Data collection} \label{sec:data}
%---------------------------------------------------------------------------
The data in this project come from two sources: 1) numerical models of deformed polycrystalline aggregates and 2) direct texture measurements from field samples using electron backscatter diffraction. 

\subsection{VPSC modelling}

A number of methods exist to numerically model texture development by describing the orientation of individual grains, and how these change as strain is applied. Numerical models provide a versatile dataset for this study as strain is known accurately for all textures, making it easy to relate the calculated indices to strain. Some of the earlier, simpler models are purely kinematic in nature, such as \cite{Etchecopar1977}, who minimises the overlap and gaps between grains modelled as polygons in two-dimensions as strain is applied. Further work increased the complexity of these kinematic models \citep[e.g. using differential equations,][]{Ribe1989}. In contrast to these simple models, full field models exist \citep[e.g. finite element,][]{Sarma1996} whereby the physical behaviour of each crystal is modelled in detail, including the interactions with its neighbours. This level of detail makes their computation relatively slow \citep{Goulding2015}.

%---------------------------FIG---------------------------------------------   
\begin{figure}[t]
  \centering
    \includegraphics[width=\textwidth]{VPSC_fig.pdf}
  \caption[VPSC method]{Schematic diagram demonstrating the key idea of the VPSC method. The \textbf{left panel} shows a grain (in red) embedded within other grains within a sample (lines show their orientation). The \textbf{right panel} shows how this same grain is modelled as an inclusion in a homogeneous equivalent medium (HEM) which is the average of all the black grains in the left panel. After \cite{Castelnau1996}.}
  \label{fig:VPSC_method}
\end{figure}
%---------------------------FIG--------------------------------------------- 

A commonly used approach that allows compromise between these two groups of models is viscoplastic self consistent (VPSC) modelling \citep{Molinari1987,Lebensohn1993}. In this model, stress and strain rate are not calculated between each grain. Instead individual grains are considered to be an inclusion in a \lq{}homogeneous effective medium\rq{} (Figure \ref{fig:VPSC_method}) which is the average of all the surrounding crystals \citep[i.e. nearest neighbour effects are not taken into account][]{Castelnau1996}. As such, the stress and strain rate tensors are not equal for all grains. Beginning with a set of randomly orientated grains, the system is solved in a self-consistent manner until the average stress and strain rate for all the crystals is equal to the macroscopic equivalents imposed. At this point the grains will have rotated to accommodate the strain, and the next strain step can begin. This approach has proved useful in many geophysical settings \citep[e.g.][]{Wenk1999}.

A VPSC models were ran by Dr Andrew Walker (University of Leeds), to provide a range of datasets, as outline in table \ref{tab:VPSC_data}. The output of a VPSC run is a list of Euler angles sets $\{\phi_1,\Phi,\phi_2\}$ that describe the orientation of individual grains at that strain step. Although a useful source of data, VPSC models assume all deformation is due to slip systems, and ignore known physical processes such as dynamic recrystallization \citep[see,][]{Stipp2002}.      

\begin{table} 
	\centering
	\caption[VPSC datasets]{Details of all datasets created using VPSC modelling. VPSC models were ran by Dr Andrew Walker (University of Leeds).\\}
\begin{tabularx}{\textwidth}{X X c c}
	\hline
	\hline
	Crystal Type    & Deformation Type  & No. Strain Steps & No. grains \\
	\hline
	\hline
	Olivine         & Axial compression & 25   & 10,000 \\
	Olivine         & Simple shear      & 39   & 10,000 \\
	Quartz          & Axial compression & 25   & 10,000 \\
	Quartz          & Simple shear      & 200  & 10,000 \\
	Post-perovskite & Axial compression & 25   & 10,000 \\
	Post-perovskite & Simple shear      & 2000 & 10,000 \\
	\hline
	\end{tabularx}
\label{tab:VPSC_data}
\end{table}

\subsection{Electron backscatter diffraction}

%---------------------------FIG---------------------------------------------   
\begin{figure}[h!]
  \centering
    \includegraphics[width=\textwidth]{EBSD_Pole_Figs.pdf}
  \caption[EBSD data (pole figures)]{A range of quartz c-axis CPO fabrics from the Annapurna-Dhaulagiri Himalaya. Contours shows multiples of uniform distribution. Maximum and minimum values of multiples of uniform distribution are next to each pole figure, with the sample number displayed beneath. The samples have been ordered qualitatively from the lowest strain (1) to the highest (10) by comparing pole figures with those in the literature. These pole figures and sample numbers represent the EBSD data that was used in this project \citep[made available from][]{ParsonsThesis}.}
  \label{fig:EBSD_data}
\end{figure}  
%---------------------------FIG---------------------------------------------   
    
    
Electron backscatter techniques have long been used to study properties of crystals and polycrystalline materials. A number of methods have arisen to determine crystal orientation data using a scanning electron microscope (SEM), including electron channeling patterns and X-ray Kossel-line techniques. However, these have been surpassed by electron backscatter diffraction \citep[EBSD or backscatter Kikuchi diffraction,][]{Harland1973}.  Here an electron beam is fired at a steeply tilted crystalline sample (to decrease path length for backscattered electrons), which produces distinctive backscatter Kikuchi patterns. These patterns are captured by a phosphor screen and digitised by a camera, and then be analysed by software to determine crystal orientation information from their geometry  \citep{Zaefferer2007}. By moving the beam over the sample, the orientation information of all grains can be determined. \cite{Prior1999} offer a thorough description of the EBSD technique, specifically it use for rock texture. Further discussion of the technique is beyond the scope of this project \citep[see][for more info]{Schwarzer1997,Randle2000}.    

Orientation data for a number of samples measured using EBSD were made available by \cite{ParsonsThesis}. The data are from the Annapurna-Dhaulagiri Himalaya, and provide samples with a range of strains that are qualitatively arranged in order from pole figure 1 (least strain) to pole figure 10 (most strain), composed predominately of quartz crystals (Figure \ref{fig:EBSD_data}). 



%---------------------------------------------------------------------------
\section{Implementation}
%---------------------------------------------------------------------------

In the following section I describe how the data presented in Section \ref{sec:data} are combined with the theory outlined in Chapter \ref{chap:theory} to calculate the texture indices and gain other useful information. An objective of this study was to create a coherent and versatile suite of \texttt{Matlab} functions to study texture strength (a \emph{toolbox}), as opposed to writing \lq{}static\rq{} scripts that would function solely as part of this project. The functions are organised into three groups, which I will describe over the following sections. Due to the considerable effort undertaken to create this toolbox, in the final section I describe the coding practices and principles used, as well as outlining important aspects of the development and use of the software. In some sense the toolkit is as much of a \lq{}result\rq{} of this project as the analysis of the texture indices that it enables. All source code is available from https://github.com/ee12lmb/TextureStrength.                                                                                                     


\subsection{Additional software}
Before outlining the software that I have developed, it is important to introduce two additional \texttt{Matlab} toolboxes which have provided integral functionality to my own code. The \texttt{MTEX} texture analysis package\footnote{http://mtex-toolbox.github.io/} \citep{Bachmann2010,Mainprice} provided efficient ODF calculation from orientation data, raw EBSD file reading and other tools. Some of what I have done is to streamline and standardise these specifically for texture strength index calculations, in addition to writing my own methods. The \texttt{MSAT} seismic anisotropy toolbox\footnote{http://github.com/andreww/MSAT} \citep{Walker} was used to calculate the anisotropy measured used (see section \ref{sec:anisotropy_indices}).    

\subsection{Data input and sampling}

This group of functions (directory \lq{}/dev/readfiles\rq{} on disc, see table \ref{tab:read_functions}) deals with the input of orientation data from both VPSC models and EBSD data (in .ctf format). The functions \texttt{read\_{}VPSC} and \texttt{read\_{}EBSD} (derived from original code from  Andrew Walker\footnote{https://github.com/andreww/microtecm} and Amicia Lee\footnote{https://github.com/earall/EBSD\_{}Melts} respectively) will extract an array of Euler angles defining the orientation of the individual grains within the sample, as well as other metadata such as the number of grains, crystal symmetry (EBSD only) and number of strain steps (VPSC only).                                                

Building on this basic functionality, a useful tool is subsampling from a larger dataset (i.e. extract $n$ random grains from a total of $N$). This allows for analysis of the robustness of the indices, but also statistical analysis and efficient index calculations. The functions \texttt{sample\_{}VPSC} and \texttt{sample\_{}EBSD} will sample from a file, while the function \texttt{sample\_{}texture} will do the same for an array of Euler angles loaded into the \texttt{Matlab} environment. These functions take an input seed so that the same \lq{}random\rq{} samples can be generated to allow repeatability. Also in this group are some internal functions such as \texttt{lookupSym} which returns an \texttt{MTEX} crystal symmetry object \citep{Bachmann2010} for a given crystal name (e.g. \lq{}olivine\rq{}) and \texttt{get\_{}inputInfo} which combines all of the functionality in this section into a compact form.                                                                                                                            

\begin{table}[h!] 
	\centering
	\caption[Functions: reading \& sampling]{Functions used for reading in and sampling either VPSC or EBSD data, finding crystal symmetries and other data related tasks.}
	\noindent
	
\begin{tabularx}{\textwidth}{lX}

\hline
\hline
Function    & Description   \\ 
\hline
\hline

\texttt{setup\_{}env} & Function initialises the \texttt{MTEX} package and adds paths to all other functions, including \texttt{MTEX} and \texttt{MSAT}. Stores a global variable to indicate this has been completed (to prevent this occurring at each separate function call). \\  
\\
\hline

\texttt{read\_{}VPSC} & Will extract Euler angles and strain information from VPSC files, if output in Bunge convention. If multiple strain steps are present their information will be stored in a cell array (edited from original code by Dr Andrew Walker). Returns strain values at each strain step in the VPSC model, as well as other meta data. \\ 

\texttt{sample\_{}VPSC} & Loads data using \texttt{read\_{}VPSC} and then returns $n$ randomly sampled grains (without replacement). \\  
\\
\hline

\texttt{read\_{}EBSD} & Similar to \texttt{read\_{}VPSC}, but reads in EBSD files (*.ctf format), returning the number of grains and other meta data. \\

\texttt{sample\_{}EBSD} & Similal to \texttt{sample\_{}VPSC} but for EBSD files (*.ctf format). \\ 
\\
\hline

\texttt{sample\_{}texture} & Samples an array of Euler angles already loaded into the \texttt{Matlab} environment, using one of the \texttt{read} functions, in the same way as the other \texttt{sample} functions. \\

\texttt{lookupSym} & Takes a string containing a crystal name, and retrieves the appropriate crystal symmetry object from \texttt{MTEX}. \\

\texttt{get\_{}inputInfo} & Combines the functionality of the above functions, and so can deal with any input type (used internally for all \texttt{index} functions). Returns Euler angles and any appropriate meta data, depending on the input type. \\
\\
\hline
\hline

\end{tabularx}
\label{tab:read_functions}
\end{table}

\subsection{Index calculation} \label{sec:index_calc}

There are three index calculations available in this toolbox (each with their own directory on disk, see table \ref{tab:index_functions}). The function \texttt{j\_{}index} uses a number of tools provided in \texttt{MTEX},  such as \texttt{calcODF} which statistically calculates the orientation distribution function, and \texttt{textureindex} which calculates the J-index from this ODF \citep[for details on their method of ODF calculation see][]{Hielscher2008}. Similarly, \texttt{m\_{}indexCont} uses this ODF to calculate a \emph{statistical} misorientation distribution function (MDF) for the input Euler angles.  This MDF is then subtracted from the theoretical random MDF to give what I call the \emph{continuous M-index} (equation \ref{eq:Mindex_cont}) due to its statistical nature.  Although much of the essential tools are derived from \texttt{MTEX}, both \texttt{j\_{}index} and \texttt{m\_{}indexCont} utilise the functionality described in the previous section in combination with consistent syntax to streamline index calculation using a number of inputs and calculation parameters (e.g. the number of grains $n$ to use, see listing \ref{lst:calcIndices} at the end of this chapter).         

The function \texttt{m\_{}indexDisc} is more involved in its calculation and only relies on \texttt{MTEX} to produce the theoretical misorientation angle distribution for a given symmetry (using \texttt{calcAngleDistribution}). As with the other index functions, \texttt{m\_{}indexDisc} takes either EBSD, VPSC or a list of Euler angles as input, as well as a number of input calculation parameters, using a consistent syntax (e.g. listing \ref{lst:calcIndices}). To find the misorientation angle distribution, I wrote the function \texttt{discreteMDF}, which finds the misorientation matrix ($\tilde{g}$, equation \ref{eq:misor_matrix}) between all combination of grains within the sample \citep[uncorrelated misorientation angle distribution,][]{Mainprice}. Each $\tilde{g}$ is passed to \texttt{calDisorientation}, a function I wrote that finds the disorientation \citep{Grimmer1979} by applying symmetry operators for the chosen crystal structure and choosing the smallest misorientation angle (see appendices \ref{App:M-index_calc} and \ref{App:symp_ops}). Once these are found, \texttt{discreteMDF} returns a list of misorientation angles to \texttt{m\_{}indexDisc} which counts them in bins (the width of which is specified by the user, in degrees) and finds the difference between this calculated misorientation angle distribution and the theoretical random distribution. For detail on the theory see Section \ref{sec:indicies} and \cite{Skemer}, for a detailed breakdown of the \texttt{m\_{}indexDisc} algorithm see Appendix \ref{App:M-index_calc}.                                            

All three index functions are designed consistently, e.g. if given a VPSC input file they will return the strain of each step as well as the index calculated. At the request of the user, output can be dumped to a text file with headers describing metadata (e.g. input file, index calculated etc.).                                                                                                                    

\begin{table}[h!] 
	\centering
	\caption[Functions: index calculation]{Functions to calculate the various indices, and internal functions within them (that still have use as standalone tools).}
	\noindent
	
\begin{tabularx}{\textwidth}{lX}

\hline
\hline
Function    & Description   \\ 
\hline
\hline
\texttt{j\_{}index}$^{\dagger}$ & Calculates the J-index for either VPSC, EBSD or array of Euler angles as input, for $n$ randomly sampled grains (without replacement). If input is VPSC, will also return a vector of strain values. Uses some elements of the \texttt{MTEX package}. \\ 
\\
\hline

\texttt{m\_{}indexCont}$^{\dagger}$ & Similar to \texttt{j\_{}index} but calculates the continuous M-index. \\

\texttt{continuousMDF} & Finds the continuous misorientation angle distribution for a given dataset and crystal symmetry. For use in \texttt{m\_{}indexCont}. \\
\\
\hline

\texttt{m\_{}indexDisc}$^{\dagger}$ & Calculates the discrete version of the M-index for VPSC, EBSD or array of Euler angles as input, for $n$ randomly sampled grains (without replacement). Bin size can be specified for the calculation. Can also plot misorientation angle distribution at each strain step. For full algorithm see Appendix \ref{App:M-index_calc}. \\

\texttt{discreteMDF} & Finds the discrete misorientation angle distribution for a given dataset and crystal symmetry. For use in \texttt{m\_{}indexDisc}. \\

\texttt{calDisorientation} & Finds the minimum angle needed to rotate one crystal onto the other, given a crystal symmetry (for use in \texttt{discreteMDF}, see Appendix \ref{App:M-index_calc} and \ref{App:symp_ops}). \\
\hline
{} & $^\dagger$can output to formatted datafile \\
\hline
\hline
\end{tabularx}
\label{tab:index_functions}
\end{table}

\subsection{Analysis functions}

I wrote a number of functions to aid further analysis of the texture indices and add functionality to the toolkit (directory \lq{}/dev/analysis\rq{} on disc, see table \ref{tab:analysis_functions}). The function \texttt{index\_{}repeat} will calculate the indices described in the previous section a specified number of times, sampling \emph{with} replacement. For example, if the input was a VPSC file with 10,000 grains in each strain step, the J-index could be calculated 50 times, subsampling a different $n$ grains each time. This is useful in analysing the variability of each index and how this changes as calculation parameters are varied.  As with the other \texttt{index} functions, \texttt{index\_{}repeat} can output to file.

The function \texttt{read\_{}texout} reads in the output files from the \texttt{index} functions. This is useful as the output of data to disk allows separation of generating the data (which can take many hours for large index calculations), and creating figures from the output (for example output file, see Appendix \ref{App:example_output}).

One of the objectives of this study was to determine whether the indices are a good proxy for strain. Assuming there is a relationship, it is possible to convert an index value to a strain value. I wrote \texttt{get\_{}strain} to take an index as input, usually calculated from EBSD data (where strain is unknown), and find a strain value for by comparing this index value to an appropriate reference curve calculated for VPSC data (where strain is known for any index value). This is essentially a way of estimating strain for an EBSD input data set (see Appendix \ref{App:strain} for details). Finally I wrote \texttt{calc\_{}anisotropy} which can take the same inputs as the \texttt{index} function, and uses tools from \texttt{MSAT} to calculate uA and lmA (see Section \ref{sec:anisotropy_indices}).

\begin{table}[h!] 
	\centering
	\caption[Functions: analysis]{List of functions used to analyse the index calculations, either by reading in output files for further calculations, or aiding statistical analysis.}
	\noindent
	
\begin{tabularx}{\textwidth}{lX}

\hline
\hline
Function    & Description   \\ 
\hline
\hline
\texttt{index\_{}repeat}$^{\dagger}$ & Will calculate any of the \texttt{index} functions a number of times (for a specific strain step and number of grains $n$), using a different seed to resample the data each time (\emph{with} replacement). \\

\texttt{get\_{}strain} & Takes either an output file from a \texttt{index} function, or a single index value as input. Will calculate the strain for this index value by interpolating index-strain VPSC reference curves for either simple shear or axial compression deformation regimes (specified by user). For details see Appendix \ref{App:strain}. \\

\texttt{calc\_{}anisotropy}$^\dagger$ & Takes VPSC, EBSD, or array of Euler angles as input, and calculates the universal anisotropy index and the \cite{Ledbetter2006} index for $n$ randomly sampled grains (without replacement) using tools for \texttt{MSAT}. \\

\texttt{read\_{}texout} & Will read formatted data files output by all \texttt{index} functions (and \texttt{calc\_{}anisotropy}). \\
\hline
{} & $^\dagger$can output to formatted datafile \\
\hline
\hline
\end{tabularx}
\label{tab:analysis_functions}
\end{table}

\subsection{Software development and use}

While developing the software for this project, I followed a number of scientific programming practices --- namely those outlined by \cite{Wilson2014}. For example, each function contains documentation on its usage that can be accessed through the \texttt{Matlab} function \texttt{help}. There are references to the literature, detailed comments and clear variable names to make it easy to follow the algorithms. Version control software \texttt{Github} was used to track the development of the code. This allows for future users to see the development through time, as well as giving a platform for distribution\footnote{https://github.com/ee12lmb/TextureStrength}.


All functions have been developed with consistent syntax in their use. Listing \ref{lst:calcIndices} demonstrates the simplicity with which the three \texttt{index} functions can be used to calculate the indices using a VPSC input data file in the \texttt{Matlab} environment.

\begin{program}[htbp] 
   \centering
   \begin{lstlisting}
% initialise MTEX and add paths to relevant functions
setup_env;   
   
% store file path to VPSC data
VPSC = '~/project/data/olivine_axial_compress_VPSC_big/TEX_PH1.OUT';

% call discrete M-index function and output to file
[ m_disc , strain ] = m_indexDisc(VPSC,1000,1,'crystal','olivine',...
                                'bin',1,'outfile','~/m_disc.out');

% call continuous M-index function and output to file
% don't require strain as it was retrieved by previous function
m_cont = m_indexCont(VPSC,1000,1,'crystal','olivine',...
                                        'outfile','~/m_cont.out');

% call J-index function and output to file
j = j_index(VPSC,1000,1,'crystal','olivine','outfile','~/j_ind.out');


 \end{lstlisting}
   \caption{Snippet of code to calculate the discrete M-index, continuous M-index and J-index using a VPSC input data file. All indices are calculated for the same 1,000 grains, using olivine symmetry, with the output file names given after the \lq{}outfile\rq{} flag. The discrete M-index is calculated with a bin width of 1$^\circ$.}
   \label{lst:calcIndices}
\end{program}

Although built for use in the \texttt{Matlab} environment, most analyses were run in batches from the command line, with the data output to file which would then be read in via \texttt{read\_{}texout} in a post-processing script and figures generated. Figure \ref{fig:analysis_workflow} shows the general data processing structure that is used for most of the various analyses.

I optimised elements of the code when it became apparent significant computational time was wasted due to inefficiencies. For example, the time taken to read in a data file using \texttt{read\_{}VPSC} would increase $O(N_s^2)$ as more strain steps were added to the VPSC file (where $N_s$ is the number of strain steps). Due to the exceptionally large data files (e.g. 10,000 grains per strain increment, with 26 increments gives 260,000 grains total), it was necessary to modify the code. After optimisation, read time increased by $O(N_s)$ (see appendix Figure \ref{fig:app:read_VPSC}). 

%---------------------------FIG---------------------------------------------   
\begin{figure*}[p]
  \centering
    \includegraphics[width=\textwidth]{analysis_workflow}
  \caption[Typical data processing workflow]{Typical data processing workflow. Dark grey boxes indicate general steps and light grey gives examples. The general calculations were always run via shell scripts for two reasons: 1) it is easier to check over the inputs to ensure they are correct/re-run the analysis if necessary and 2) the calculations could be run across the university servers rather than one-by-one on an individual instance of \texttt{Matlab}, greatly increasing efficiency.}
  \label{fig:analysis_workflow}
\end{figure*}
%---------------------------FIG---------------------------------------------   


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Analysis} \label{chap:analysis}
\vspace{-1cm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
I have broken down the assessment of the texture indices into two sections. By their definition it is expected the indices will be sensitive to strain. However, it is first important to establish whether other parameters inherent in their calculation, such as the number of grains, will affect their output \emph{(robustness)}. The aim is to determine what is necessary to find the \lq{}true\rq{}, or most accurate, index value of a given sample. I compare my results with the literature, particularly with \cite{Skemer} as their motivation for creating the M-index was to provide a more robust measure of texture strength. After determining what criteria need to be met to produce an accurate index value, I present analysis of the relationship between strain and the indices \emph{(proxy for strain)} with confidence that the values presented are accurate and representative of the given sample/model. I studied the robustness of the indices and their use as a proxy for strain using VPSC models and EBSD data from field samples (see Section \ref{sec:data}). As such, a mix of results from both are included in each section to support conclusions from two independent data sources and to validate these for field data. I chose the results presented here to best represent the analyses conducted, but provide appendix references to additional results when necessary.       


%---------------------------------------------------------------------------
\section{Index robustness}
%---------------------------------------------------------------------------
In the following section I analyse aspects of index calculation. This includes the number of grains required, the effect of bin size on the discrete M-index, and the general variability of the indices for subsamples of the same texture. 

\subsection{Number of grains} \label{sec:no_grains_analysis}

One of the first aspects to consider when calculating any texture index is the number of grains $n$ that will be used. An index might be considered robust if its value is independent of the number of grains input in the calculation (i.e. an index value calculated using 1,000 grains from a texture would be similar to the same index calculated using 100 grains from the same texture). However, an index will never be completely independent of the number of grains, but would be expected to converge to a certain value past a threshold. This is clear as a larger number of grains will be more representative of the texture as a whole, allowing for a more accurate index calculation. To analyse this, I calculated each index using a range of $n$ for a number of strain steps in an olivine VPSC model undergoing axial compression (Figure \ref{fig:OLV_AXC_n_conv}). 

%---------------------------FIG---------------------------------------------   
\begin{figure}[bht]
  \centering
    \includegraphics[width=\textwidth]{figs/OLV_AXC_Conv_INTERP}
  \caption[Convergence with no. grains (olivine VPSC)]{Convergence plots for J-index, continuous M-index and discrete M-index calculated for an olivine VPSC model undergoing axial compression. The panels show increasing strain steps with (a) 2\%, (b) 16\%,(c) 30\% and (d) 42\% strain. Each data point is the avaerage of 50 calculations, with $n$ randomly sampled grains from a total of 10,000 (sampled with replacement). Calculations were ran for $n$ = 5, 10, 50, 100, 200, 500, 1,000, 2,000, 5,000 and 10,000. Error bars are from the standard deviation of these 50 measurements. All indices show convergence to constant values for calculations that use approximately 1000 grains and above, with standard deviation decreasing rapidly as the number of grains is increased.}
  \label{fig:OLV_AXC_n_conv}
\end{figure}
%---------------------------FIG---------------------------------------------   


All indices show convergence as the number of grains used in their calculation increases. Both the J-index and the continuous M-index converge smoothly at similar rates, as they are both calculated statistically (Section \ref{sec:index_calc}). At very low $n$ ($<$50) the discrete M-index value is many times greater than the converged value. This is inherent in the calculation of this index as it requires enough data to construct a histogram to represent the misorientation angle distribution of the texture, which will not be possible with low numbers of grains. Although the value is initially far from the converged value, the discrete M-index has a much higher rate of convergence that the other indices. This is similar to findings of \cite{Skemer} in that convergence is rapid, although they find this occurs at smaller $n$. In contrast to \cite{Skemer}, this effect is more pronounced at higher strain rates, which can be seen when comparing (a) with (d) in Figure \ref{fig:OLV_AXC_n_conv} (the discrete M-index curve has levelled at lower $n$ in (d)), although these data are calculated from a VPSC model and not EBSD data as in \cite{Skemer}.

%---------------------------FIG---------------------------------------------   
\begin{figure}[t!]
  \centering
    \includegraphics[width=\textwidth]{figs/EBSD_QTZ_n_Conv.pdf}
  \caption[Convergence with no. of grains (quartz EBSD)]{Convergence plots for J-index, continuous M-index and discrete M-index calculated for an quartz EBSD data. The panels show pole figures of approximately increasing strain. Each data point is the avaerage of 50 calculations, with $n$ randomly sampled grains from a total of 10,000 (sampled with replacement). Calculations were ran for $n$ = 5, 10, 50, 100, 200, 500, 1,000, 2,000 and 5,000. Error bars are from the standard deviation of these 50 measurements. All indices show convergence to constant values for calculations that use approximately 1000 grains and above, with standard deviation decreasing rapidly as the number of grains is increased.}
  \label{fig:EBSD_QTZ_n_conv}
\end{figure}
%---------------------------FIG---------------------------------------------   

To allow for this comparison, I repeated this calculation for a number of quartz EBSD samples (Figure \ref{fig:EBSD_QTZ_n_conv}). It is clear that the behaviour of the indices is very similar as $n$ is increased in this case, with some indices converging as low as $n =$ 500, but more generally at $n =$ 1,000. This supports the threshold found using olivine VPSC data, using both real field data as well as crystals with different symmetry. These results still differ from \cite{Skemer} who cite convergence as low as $n = 150$. 

      
%---------------------------FIG---------------------------------------------   
\begin{figure}[h!]
  \centering
    \includegraphics[width=\textwidth]{figs/OLV_AXC_std_conv_INTERP}
  \caption[Index error with no. grains (olivine)]{Relationship between index standard deviation and number of grains used for index calculation, for an olivine VPSC model undergoing axial compression. The data points are the standard deviation of 50 calculations, with $n$ randomly sampled grains for each calculation sampled with replacement from a VPSC model of 10,000 grains total. Calculations were ran for $n$ = 5, 10, 50, 100, 200, 500, 1,000, 2,000, 5,000 and 10,000. The panels show increasing strain with (a) 2\%, (b) 16\%, (c) 30\% and (d) 42\%.}
  \label{fig:OLV_AXC_n_conv_err}
\end{figure}
%---------------------------FIG---------------------------------------------


Having established how the indices converge it is also useful to know how their variability will change with $n$, to give some idea of error bounds. To determine this, I calculated the indices 50 times for each value of $n$. For example, the data point for the continuous M-index at $n = 100$ grains was calculated 50 times, sub-sampling from a total of 10,000 grains (with replacement). The error bars on figures \ref{fig:OLV_AXC_n_conv} and \ref{fig:EBSD_QTZ_n_conv} are from the standard deviation $(\sigma)$ of these 50 calculations (with the plotted data point being the mean).

To further analyse this, I plotted $\sigma$ as a function of $n$ in Figure \ref{fig:OLV_AXC_n_conv_err} (appendix Figure \ref{fig:app:QTZ_EBSD_n_conv_err} for EBSD equivalent). There is a clear trend of decreasing $\sigma$ as the number of grains is increased, although the benefit of increasing $n$ is reduced past approximately 1,000 grains, as $\sigma$ converges close to zero (for all indices). This compliments the convergence threshold as at $n >$ 1,000 all indices have converged to a \lq{}true\rq{} value, with the addition of the error being within acceptable bounds. The discrete M-index shows an anomalous drop in $\sigma$ at $n = 5$. This is due to a lack of grains to form a representative histogram of the misorientation distribution, and therefore when this distribution is so poorly defined the index will produce similarly \lq{}wrong\rq{} values --- therefore a smaller standard deviation will result.

\subsection{Bin size (discrete M-index)} \label{sec:bin_size}

Having established that $n \approx$ 1,000 is required for convergence, I investigated other calculation parameters independently of any effect of $n$, by ensuring all calculations are within this convergent regime. 

From Figure \ref{fig:OLV_AXC_n_conv} it is clear the discrete M-index consistently converges to a value greater than the continuous M-index. Similar behaviour is seen in the quartz EBSD data for pole figures 1, 4 and 9, although not for 7 (Figure \ref{fig:EBSD_QTZ_n_conv}). A calculation parameter that can potentially alter the converged (with respect to $n$) value of the M-index is the bin width of the histogram that makes up the misorientation angle distribution.   

%---------------------------FIG---------------------------------------------   
\begin{figure}[h!]
  \centering
    \includegraphics[width=\textwidth]{figs/OLV_AXC_bin_conv.pdf}
  \caption[Convergence with bin size (olivine)]{Discrete M-index convergence as bin size is decreased. The data are from analysis of an olivine VPSC model which has undergone axial compression. Each data point was calculated using the same 2,0000 grains, to ensure the indices calculated have converged (in terms of number of grains, see Fig. \ref{fig:OLV_AXC_n_conv}). Panels show increasing strain, with (a) 2\%, (b) 16\%, (c) 30\% and (d) 42\%. The grey line is the continuous M-index calculated for the same 2,000 grains for reference.}
  \label{fig:OLV_AXC_b_conv}
\end{figure}  
%---------------------------FIG---------------------------------------------   

I calculated the discrete M-index for bin sizes ranging from 3$^\circ$ to 0.25$^\circ$ in 0.25$^\circ$ increments for olivine VPSC model undergoing axial compression, using $n$ = 2,000 grains (Figure \ref{fig:OLV_AXC_b_conv}, continuous M-index shown for reference). It is evident that bin size has significant effect on the value of the discrete M-index, as at all strains the value is much greater at a bin size of 3$^\circ$ than at 0.25$^\circ$ (in some cases approximately double), and decreasing bin size results in convergence towards the continuous value. If increasing the number of grains gives more information about the texture, then decreasing the bin size offers better resolution of this information (in terms of the misorientation angle distribution), so this relationship is expected. Essentially a larger bin size gives a coarser representation of the misorientation angle distribution (Figure \ref{fig:OLV_bin_size_example}). This makes a smaller bin size preferable, and in the discrete M-index method there is no penalty in terms of calculation time as misorentation angles for \emph{all} pairs are grains are calculated regardless of bin size. The only difference is the histograms that are subtracted (see Appendix \ref{App:M-index_calc}).

%---------------------------FIG---------------------------------------------   
\begin{figure}[h]
  \centering
    \includegraphics[width=\textwidth]{figs/OLV_Bin_Size_Example.pdf}
  \caption[Bin size example (olivine VPSC)]{Misorientation angle distribution for olivine VPSC model undergoing axial compression, $n$ = 2,000, strain = 40\%. Panel \textbf{(a)} shows the distribution with a bin size of 3$^\circ$ and panel \textbf{(b)} shows the same distribution with a 0.5$^\circ$ bin size. The density of bins in panel (b) makes visualisation difficult. However, it is clear that the larger bin size in (a) is a much coarser representation of the distribution.}
  \label{fig:OLV_bin_size_example}
\end{figure}  
%---------------------------FIG---------------------------------------------   


Although smaller bin sizes are preferable, there is a functional limit on bin width. For example, if a bin size of $\theta_{bin}$ = 0.5$^\circ$ is used to calculate the M-index for an olivine VPSC model, the number of bins $b_n$ would be:

\begin{equation}
b_n\ =\ \frac{\theta_{max}}{\theta_{bin}}\ =\ \frac{120^\circ}{0.5^\circ}\ =\ 240\ . 
\end{equation}     
\noindent
As each grain is compared to all others around it, the number of pairs of grains $p_n$ (and therefore the number of misorientation angles) is given by:

\begin{equation}
p_n\ =\ \sum^{n-1}_{i=1}(n - i)\ =\ \frac{n}{2}(n-1)\ ,
\end{equation} 
\noindent
giving the absolute minimum value of $n$ to allow at least one misorientation angle to lie in each bin to be $n$ = 23 (see Appendix \ref{App:min_no_grains}). In reality this is an extreme lower bound as having a single angle in each bin will never represent the misorientation angle of the distribution of a sample with enough accuracy to produce a meaningful index value. However this demonstrates that, especially when small numbers of grains are available, care must be taken when choosing bin width. 

Returning to Figure \ref{fig:OLV_AXC_b_conv}, even at at bin size of 0.25$^\circ$ the discrete M-index does not fully converge to the continuous value (panel (a) shows some evidence of convergence \emph{above} the continuous value). One explanation for this is the inherent differences in their calculation. The continuous M-index is calculated from a misorientation distribution function that is in turn calculated \emph{statistically} from an orientation distribution function. This ODF inherently undergoes smoothing in its calculation from the orientation data \citep[e.g. regularisation when inverting for the ODF in the \texttt{MTEX} algorithm, see][]{Hielscher2008}. Any smoothing will reduce the \lq{}sharpness\rq{} of this function and so the continuous M-index will tend to be lower than the discrete M-index (which has no smoothing factors in its calculation). This is because the ODF, and hence the MDF, describe the texture as a whole (Section \ref{subsec:ODFs}). Essentially a smoother ODF will dampen a stronger texture to appear weaker, and hence a lower index value will result. 

%---------------------------FIG---------------------------------------------   
\begin{figure}[h]
  \centering
    \includegraphics[width=0.7\textwidth]{figs/OLV_SPS_cont_disc_diff.pdf}
  \caption[Discrete and continuous M-index difference (olivine VPSC)]{The difference between the continuous and discrete M-index calculated for an olivine VPSC model undergoing simple shear. Values are the average of 50 calculations using $n$ = 2,000 grains sampled with replacement from a total of 10,000. Error bars are the standard deviation of the indices. \textbf{Inset} shows a clearer picture of the average difference between the 50 calculations of both indices, with the same axes as the main plot. The difference is on a similar order to the actual values showing that, although the change is small, the increase in difference with strain is not negligible.}
  \label{fig:OLV_SPS_cont_disc_diff}
\end{figure}  
%---------------------------FIG---------------------------------------------   

If the discrepancy is larger for stronger textures, then the difference between the two M-indices would become larger as strain increases (assuming stronger texture results from greater strain). To determine this, I created curves of the discrete and continuous M-index as a function of strain, calculated for an olivine VPSC model undergoing simple shear (Figure \ref{fig:OLV_SPS_cont_disc_diff}). Before considering the difference between the curves, it is clear visually that they diverge as strain is increased, with the discrete M-index giving increasingly larger index values compared to the continuous. The difference curve on the main plot shows that this change is small in comparison to the index values, although not negligible, with the inset giving a clearer picture of this relationship. This divergence, although small, supports that the smoothing of the continuous M-index is the source of the discrepancy between the two methods of calculation. Figure \ref{fig:OLV_SPS_cont_disc_diff} also shows a small increase in error (standard deviation) as strain is increased. 

\subsection{Index variability and distribution}

In the following section I investigate the increase of standard deviation with strain, as observed in Figure \ref{fig:OLV_SPS_cont_disc_diff}. I calculated all three indices 1,000 times (using \texttt{index\_repeat}) for multiple strain steps in an olivine VPSC model undergoing axial compression, as well as a number of EBSD datasets, using $n$ = 1,000 grains. Figure \ref{fig:VPSC_md_dist} shows histograms of the discrete M-index values for the olivine axial compression VPSC model (centred on zero by subtracting the mean from all values). It is clear that the variability of the discrete M-index increases with strain. This result was consistent across all indices, for both the VPSC and EBSD data (see appendix figure \ref{fig:app:MD_EBSD_dist}).

%---------------------------FIG---------------------------------------------   
\begin{figure}[h]
  \centering
    \includegraphics[width=0.9\textwidth]{figs/MD_VPSC_n1000_distribution.pdf}
  \caption[Discrete M-index distribution (olivine VPSC)]{Distribution of discrete M-index values. Histograms are composed from 1,000 calculations using $n$ = 1,000 grains (larger $n$ would require excessive compute time) from an olivine VPSC model undergoing axial compression. The distributions have been centred on zero by subtracting the mean from all values to allow for easier comparison between strain steps. It is clear the spread in index values becomes greater as strain increases.}
  \label{fig:VPSC_md_dist}
\end{figure} 
%---------------------------FIG---------------------------------------------  

One explanation arises when considering the the movement of individual grains within the sample. The rotation rate of a grain at a given time is related to its current orientation. If a weak slip system in the grain is not aligned with strain, its rotation rate will be greater than one whose slip systems are in line, resulting in crystals aligning with this weak slip system parallel to the extension direction \citep[e.g. post-perovskite,][]{Walker2012}. As a result, the alignment of grains on the whole will increase (and therefore the strength of the texture), but some grains will remain in their more \lq{}random\rq{} orientation for longer. Hence taking a random sample of 1,000 grains will sometimes capture those that have, on average, become more aligned (giving a greater index value) and sometimes those that would represent a more random texture (and hence a lower index value), resulting in greater variability. In contrast, if \emph{all} grains are randomly orientated, then taking a sample of 1,000 should consistently return an equally low index.     


%---------------------------------------------------------------------------
\section{Proxy for strain}
%---------------------------------------------------------------------------

Now that I have determined the robustness and variability of the indices, I move on to analyse their relationship with strain, and whether they are an appropriate proxy. Once this relationship is established, I use it to estimate the strain of EBSD data. I analyse the seismic anisotropy measures introduced in Section \ref{sec:anisotropy_indices}, and determine the relationship, if any, between these and the indices.   

\subsection{Index-strain relationship}

To gain an understanding of the indices relationship with strain, I calculated each index for VPSC models of olivine, quartz and post-perovskite, undergoing both axial compression (strain range 2 - 50\%) and simple shear (strain range 8.75 - 350\%), using $n$ = 5,000 grains shown in Figure \ref{fig:indices_vs_strain} (appendix Figure \ref{fig:app:indices_vs_strain_DATAPOINTS} includes data points to show curves are well constrained).     

%---------------------------FIG---------------------------------------------   
\begin{figure*}[p]
  \centering
    \includegraphics[width=\textwidth]{figs/ALL_6panel_plot.pdf}
  \caption[Relation of indices to strain (VPSC)]{Relationship between the J-index, continuous M-index and discrete M-index to sample strain. Data are from VPSC models, with the indices calculated using the same 5,000 grains at each strain step (this many grains ensures the results are in the convergent regime). Discrete M-index calculated with a bin size of 0.25$^\circ$. \textbf{Top row} shows data for olivine, \textbf{middle row} shows quartz and \textbf{bottom row} shows post-perovskite (P-PS). \textbf{Left column} shows data from an axial compression VPSC model, the \textbf{right column} shows data from a simple shear VPSC model. Note the change of scale on both y-axes in \textbf{f}. Applying these scales to other plots reduces clarity --- consistent scales on all other plots (within each column) allows for useful comparison (see text).}
  \label{fig:indices_vs_strain}
\end{figure*} 
%---------------------------FIG---------------------------------------------  

It is clear the indices increase monotonically with strain for both olivine and post-perovskite. For both minerals, the indices increase relatively linearly to approximately 100 - 150\% strain, after which the behaviour of the two crystals diverges. The J-index for olivine simple shear (panel (b)) continues to increase linearly to $J_O$ = 24.26 at 350\% strain, whereas the J-index for post-perovskite is less linear, and increases to a greater value of $J_P$ = 86.49. The gradients of the M-index curves for both olivine and post-perovskite simple shear (panels (b) and (f)) decrease past 150\% strain and they begin to tend towards constant values. Both M-indices are much greater for post-perovskite (approximately double). The behaviour is more linear in the lower strain limit of the axial compression curves (50\%), although the post-perovskite M-index values are again approximately double (reasons for this are proposed in Section \ref{sec:diss_results_comp}). The similarity in index behaviour for these two minerals (compared to quartz) is likely due to their similar crystal symmetry.

%---------------------------FIG---------------------------------------------   
\begin{figure}[h]
  \centering
    \includegraphics[width=\textwidth]{figs/QTZ_Strain_Zoom.pdf}
  \caption[Relation of indices to strain (quartz VPSC)]{\textbf{NEED TO INCLUDE BIT ABOUT NUMBER OF DATA POINTS TO CONSTRAIN CURVE} Relationship between the indices and strain for quartz VPSC, calculated using the same 5,000 grains, with a bin size of 0.25$^\circ$ used for the discrete M-index calculation. Panels \textbf{(a)} and \textbf{(b)} use the same data as panels (c) and (d) in Figure \ref{fig:indices_vs_strain}, with different scales to allow clearer analysis. In particular the strain axes for the simple shear VPSC has been restricted to 50\% (denser data points were used to ensure the curves are smooth and well defined). It is clear the discrete M-index does not follow the continuous M-index at low strains, and in fact increases as strain decreases below approximately 20\%.}
  \label{fig:indices_vs_strain_qtz}
\end{figure} 
%---------------------------FIG---------------------------------------------  

From the index-strain curves for quartz (panels (c) and (d), Figure \ref{fig:indices_vs_strain}) it is clear there are a number of differences when compared to olivine and post-perovskite. Of particular importance is that all indices appear to be multivalued at high strains in the simple shear deformation regime, and in both the axial compression and simple shear cases the discrete M-index is multivalued at lower strains. This is clearly detrimental if the indices are used as a proxy for strain, as one index value would imply two different values for strain. These instances of multivalued indices require separate explanations.

At high strains the explanation is simply that the VPSC model does not include the effect of dynamic recrystallisation. This is where grains with high densities of dislocations essentially split into smaller grains, allowing strain to continue to be accommodated \cite{Stipp2002}. In the VPSC model, the grains instead rotate to align on a different slip system, creating a sinusoidal pattern whereby the texture strength fluctuates as the grains rotate in and out of alignment.   


%---------------------------FIG---------------------------------------------   
\begin{figure}[t]
  \centering
    \includegraphics[width=\textwidth]{figs/QTZ_AXC_n500_misor_dist.pdf}
  \caption[Misorientation angle distribution (quartz VPSC)]{Misorientation angle distributions for a quartz VPSC model undergoing axial compression, calculated using the same 500 grains with a bin width of 1$^{\circ}$. The panels show increasing strain with \textbf{(a)} 2\%, \textbf{(b)} 16\%, \textbf{(c)} 30\% and \textbf{(d)} 42\%. The solid line shows the theoretical misorientation distribution for a random fabric of quartz grains. The red box indicates the potential numerical error (see text).} 
  \label{fig:qtz_misorientation_dist}
\end{figure} 
%---------------------------FIG---------------------------------------------

At low strains, the discrete M-index is clearly multivalued in the axial compression case, and Figure \ref{fig:indices_vs_strain_qtz} shows that this behaviour is almost identical at similar strains in the simple shear case. To investigate this, I plotted the misorientation angle distribution for a number of strain steps in the quartz axial compression VPSC model (Figure \ref{fig:qtz_misorientation_dist}), as this is the main factor in determining the value of the M-index. It is apparent that at misorientation angles close to the theoretical maximum, the calculated distribution is greater than the theoretical distribution, even at very low strains (panel (a), red box). This will give an index value higher than expected for low strains, but this slight deviation will lose significance as strain increases, due to larger differences elsewhere in the distribution becoming the prominent factor in the calculation (e.g. panel (d)). This anomaly persists for EBSD data, and at larger $n$ and smaller bin width (see appendix Figures \ref{fig:APP_misor_dist_qtz_ebsd} and \ref{fig:app:quartz_VPSC_anomaly}).

I propose the reason for this is purely numerical. The symmetry operators for quartz are different from those of olivine and post-perovskite as the matrices for quartz often contain decimal values, rather than 0 or 1 as in olivine and post-perovskite (see Appendix \ref{App:symp_ops}). This introduces numerical errors that are worsened when recalling the calculation of the misorientation angle $\theta$ involves an inverse cosine function (from equation \ref{eq:misorientation_angle}):   

\begin{equation}
\theta\ =\ \cos^{-1}\left( \frac{(\tilde{g}_{11} + \tilde{g}_{22} + \tilde{g}_{33} - 1)}{2} \right)\ .
\end{equation}
\\
Combining this numerical error with the steep cut-off of the theoretical distribution for quartz produces the error observed in Figure \ref{fig:qtz_misorientation_dist}. This explains the lack of error for olivine and post-perovskite as the cut-off for those theoretical distributions is less sharp \citep[see Figure \ref{fig:misorientation_example}, or][for more distributions]{Wheeler2001}.

%---------------------------FIG---------------------------------------------   
\begin{figure*}[p]
  \centering
    \includegraphics[width=\textwidth]{figs/m_vs_j.pdf}
  \caption[Relationship of M- and J-indices]{M-index (continuous and discrete) as a function of J-index. \textbf{Top row} shows olivine, \textbf{middle row} shows quartz and \textbf{bottom row} shows post-perovskite, with the \textbf{left column} showing data from axial compression VPSC models and the \textbf{right column} data from simple shear. Calculations used $n$ = 5,000 grains.} 
  \label{fig:m_vs_j}
\end{figure*} 
%---------------------------FIG---------------------------------------------  
  
Continuing regardless of the multivalued nature of the quartz curves, it would be useful to know how the M-indices compare directly with the J-index. To determine this relationship, I plotted the two M-indices $M$ as a function of the J-index $J$ (Figure \ref{fig:m_vs_j}). Aside from highlighting the multivalued problem, this shows that at low $J$, and hence low strain, the indices have a relatively linear relationship (i.e. $\mathrm{d}J \approx \mathrm{d}M$). However as $J$ is increases this relationship breaks down, particularly for olivine and post-perovskite, and the gradient becomes less steep (i.e. a change in $J$ now results in a smaller change in $M$). This essentially implies that the M-index becomes saturated at lower strains in comparison to the J-index, which can also be seen in Figure \ref{fig:indices_vs_strain}. This is evidently unfavourable for an index as ideally a certain increase in $M$ will result in the same increase in strain, which is not the case for high strains in the examples presented here. Physically this makes sense --- as the majority of grains are aligned, their rotation rate will be slower, and hence there will be less difference in M-index as strain is increased.  

\subsection{Estimating strain}

Having established that the indices provide a good proxy for strain, in this section I proceed to use the relationship established by the VPSC models (where strain is known) to predict strain for a given index value. This is useful in cases where an index for a given sample can be calculated relatively easily, but strain is not known, such as the quartz EBSD dataset. I did this by linearly interpolating reference index-strain curves (see Appendix \ref{App:strain}).


%---------------------------FIG---------------------------------------------   
\begin{figure}[h]
  \centering
    \includegraphics[width=\textwidth]{figs/EBSD_ind-strain.pdf}
  \caption[Relationship of indices to strain (quartz EBSD)]{\textbf{Left} shows J-index and both continuous and discrete M-index calculated for the available pole figure data. Values are calculated using $n$ = 5,000 grains and a bin size of 0.25$^\circ$ for the discrete M-index. \textbf{Right} shows the strain calculated from these index values by linearly interpolating index-strain references curves.} 
  \label{fig:indices_vs_strain_qtz_EBSD}
\end{figure} 
%---------------------------FIG---------------------------------------------  

I calculated the index values for the pole figures, and from these values estimated the strain by interpolating the simple shear reference curve (Figure \ref{fig:indices_vs_strain_qtz_EBSD}). The index values agree with those from \cite{ParsonsThesis}. Interestingly, the J-index gives consistently larger strain values than either of the M-indices. The discrete M-index gives greater strain values than the continuous, for reasons outlined in Section \ref{sec:bin_size}.  

\subsection{Relation to seismic anisotropy}


%---------------------------FIG---------------------------------------------   
\begin{figure*}[p]
  \centering
    \includegraphics[width=\textwidth]{figs/ALL_6panel_anisotropy.pdf}
  \caption[Anisotropy measures and strain]{Seismic anisotropy measures, the Universal Elastic Anisotropy Index (uA) and the \cite{Ledbetter2006} index (lmA) against strain. \textbf{Top row} shows data from olivine VPSC models, \textbf{middle row} shows quartz, and \textbf{bottom row} shows post-perovskite. \textbf{Right column} shows data from axial compression models and \textbf{left column} shows data from simple shear models. All calculations use $n$ = 10,000 grains.} 
  \label{fig:ani_vs_strain}
\end{figure*} 
%---------------------------FIG--------------------------------------------- 

Having established the relationship between the texture indices and strain, I proceeded to create similar plots for the anisotropy indices established in Section \ref{sec:anisotropy_indices}. Figure \ref{fig:ani_vs_strain} shows the universal anisotropy index \citep[uA,][]{Ranganathan2008} and the \cite{Ledbetter2006} anisotropy index (lmA) as a function of strain for olivine, quartz and post-perovskite (using $n$ = 10,000 grains as calculation is rapid). It is clear that many features of these indices are similar to the texture indices. For example, the anisotropy indices for the quartz simple shear case (panel (d)) are again multivalued at high strains which indicates features inherent in the VPSC model are the cause (i.e. dynamic recrystallisation is not taken into account).    

This demonstrates the anisotropy indices can act as a proxy for strain in a similar way to the texture indices. In addition, the they can to some extent be measured remotely via seismology (for discussion see the following chapter). As both the anisotropy and texture indices have a similar relationship with strain, relating the two directly would allow for a texture index to be derived from the anisotropy index. This potentially provides a method for remotely estimating the strength of textures through seismic observations. Figure \ref{fig:ani_vs_m_disc} shows the anisotropy indices as a function of the discrete M-index. It is clear that the relationships are linear (with the exception of post-perovskite), making it easy to relate the anisotropy to the texture indices. 

\begin{figure*}[p]
  \centering
    \includegraphics[width=\textwidth]{figs/ALL_6panel_anisotropy_vs_m.pdf}
  \caption[Relationship of anisotropy indices and M-index (disc)]{Seismic anisotropy measures, the Universal Elastic Anisotropy Index (uA) and the \cite{Ledbetter2006} index (lmA) as a function of the discrete M-index. \textbf{Top row} shows data from olivine VPSC models, \textbf{middle row} shows quartz, and \textbf{bottom row} shows post-perovskite. \textbf{Right column} shows data from axial compression models and \textbf{left column} shows data from simple shear models. All calculations use $n$ = 10,000 grains.} 
  \label{fig:ani_vs_m_disc}
\end{figure*} 
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Discussion} \label{chap:discussion}
\vspace{-1cm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
In the following section I discuss some of the important implications that have arisen from this study. Where relevant I draw comparisons to the literature to put the findings in context, or provide explanations for the phenomena observed. Following this, I offer suggestions for further work.


\section{Review and Comparison} \label{sec:diss_results_comp}

In Section \ref{sec:no_grains_analysis} I determined that the number of grains $n$ must be $\sim$1,000 for all indices to converge. This is a small increase from \cite{Skemer} who find convergence in the range of 150 - 600 grains for a range of olivine samples. Earlier studies such as \cite{Wright1990} and \cite{Baudin1993} found that 100 orientation measurements were sufficient to find the principal components of the texture function but upwards of 1,000 to \lq\lq{}evaluate with rather good accuracy the heights of the peaks\rq\rq{} \citep{Baudin1993}. Particularly for the J-index and continuous M-index, defining the magnitude of these peaks is what controls their values, so to this extent my results agree with \cite{Baudin1993}. 

However, the results of \cite{Baudin1993} are for a single phase sample (a metal sheet). Here it is unnecessary to distinguish between crystal phases, whereas rocks this is crucial. \cite{Randle2009} reviews the improvements in EBSD practices from 2003 - 2008 (the M-index was developed in 2005) and comments that phase identification and discrimination techniques improved. Hence differences in the datasets available to \cite{Skemer} may have had an impact on their convergence analysis. In addition to convergence with $n$, I extended the analysis of \cite{Skemer} to include the variability of the indices and their error in terms of standard deviation $\sigma$. The convergence of $\sigma$ to a value close to zero for     
$n \sim$ 1,000 supports this convergence criterion. In addition, \cite{Skemer} determine that bin sizes below 5$^\circ$ have little impact on the M-index, however I found that changes in bin size from 3$^\circ$ - 0.25$^\circ$ could almost halve the discrete M-index value. It should also be noted that the discrete M-index is by far the slowest to calculate for large numbers of grains (see appendix Figure \ref{fig:app:index_speed}).

A significant result of this work is the issues encountered when extending the M-index for use in quartz, to follow from the suggestions of \cite{Skemer} to test the M-index for other materials. I encountered a numerical issue during the calculation that is likely related to the shape of the random misorientation angle ditribution for quartz and its symmetry operators. To test this fully would require arbitrary precision calculation which would involve rewriting the code and be hugely computationally expensive. Alternatively, the same analysis could be applied to crystals with similarly sharp gradients in their distribution (e.g. garnet, Figure \ref{fig:garnet}) to determine if the numerical issue persists.

 %---------------------------FIG---------------------------------------------   
\begin{figure}[h!]
  \centering
    \includegraphics[width=0.65\textwidth]{figs/QG_misor.pdf}
  \caption[Garnet misorientation angle distribution]{Misorientation angle distributions for a random texture for quartz and garnet.} 
  \label{fig:garnet}
\end{figure} 
%---------------------------FIG--------------------------------------------- 

The differences in J- and M-indices in Figure \ref{fig:indices_vs_strain} can be explained by considering the slip systems that are input into the VPSC code when generating the datasets. The slip systems used for post-perovskite are the same as P001 model used in \cite{Walker2012}, which attempts to replicate experimental work by \citep{Miyagi2010}. \cite{Miyagi2010} found that initially (001) lattice planes in post-perovskite are at high angles to compression, and when compressed from 148 GPa to 185 GPa, this preferred orientation doubles in strength, implying slip on (001). When undergoing strain, the crystals rotate faster to align along this single dominant slip system than if more were available. This implies stronger textures at lower strains.

This has important implications for determining strain from the VPSC reference curves, particularly for post-perovskite but possibly other minerals as well. As the VPSC code requires input of slip systems, this introduces a limitation as the accuracy of the returned strain value depends greatly on how well the slip systems of a mineral are known. In the case of post-perovskite, what little experimental evidence there is in the literature is often contradictory. For example, in contrast to \cite{Miyagi2010}, \cite{Merkel2007} find dominant slip systems on (100) and (110) --- \cite{Walker2012} demonstrate the significant effect these different slip systems can have on global mantle flow models. Caution must be taken when inferring strain from index values in these cases where slip systems are poorly constrained.

In addition to strain, the relationship between the anisotropy indices and the texture indices potentially offers a remote way to measure texture strength. However, uA would be a challenge to measure via seismology as it involves inversion for the elastic tensor of the material. It may be possible to estimate lmA, provided that source-receiver pairs provide sufficient azimuthal coverage. Addition studies are required to draw any conclusions.   
  


\section{Future work}

Further investigation of the number of grains required for convergence could incorporate the statistical parameter of \cite{Pospiech1994}, such as the work of \cite{Bozzolo2007}. A similar parameter based on the M-index could aid further investigate on its convergence. To establish the cause of the discrepancy between the continuous and discrete M-index, the effect of ODF smoothing on the continuous M-index needs to be established \citep[possibly by analysing the kernel method of][]{Hielscher2008} 

The ability to predict strain from the index-strain curves needs to be expanded. Curves for different deformation mechanisms should be calculated to allow prediction for a wider range of samples \citep[possibly using more advanced texture modelling e.g.][]{PonteCastaeda2002}. To the same effect, more crystal symmetries should be added to the toolbox (and can be easily, due to its modular design) to: 1) expand its capabilities and 2) investigate the numerical error seen in the discrete M-index computation for quartz. Quantification of the error when estimating strain is also necessary.

Finally, I have only touched on the relationship of the texture indices to the anisotropy indices. Future studies could analyse the validity of this relationship, in addition to investigating practical use for it.  



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Conclusion} \label{chap:conclusion}
\vspace{-1cm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
An important result from this work is the production of a functioning \texttt{Matlab} toolbox for use in quantitative texture strength analysis. I developed this toolbox to function as a standalone package, using version control software to track its development. The toolbox allows easy calculation and analysis of texture indices, as well as additional functionality (e.g. strain estimation) for both VPSC and EBSD datasets. 

Using this software package, I analysed the robustness of the J-index, and the discrete and continuous M-indices. I found that the number of grains used in calculating all indices should be $n \approx$ 1,000 grains or greater for convergence to a \lq{}correct\rq{} value, and for the error $(\sigma)$ to be within acceptable limits, showing the J-index is equally robust as the M-index. In addition, the bin size for the discrete M-index has significant affect on its output value, with smaller bin size resulting in convergence towards the continuous M-index (although a functional limit exists, which is related to the number of grains). The discrete M-index will not converge totally to the continuous, which is likely due to smoothing inherent in the continuous M-index calculation. The variability of all three indices increases with strain, although the effect is small enough to be neglected.

I extended the analysis of \cite{Skemer} and \cite{Mainprice} to establish whether the J- and M-indices are a useful proxy for strain for both quartz and post-perovskite, in addition to olivine. I found the indices to generally increase monotonically with strain, with the notable exception of quartz for which the discrete M-index appears to be multivalued at low strains. I determined this is likely due to a numerical error in its calculation, which is related to the theoretical misorientation angle distribution for quartz but may reduce the effectiveness of the M-index (although subsequent work on additional crystal symmetries is required to confirm this). From this index-strain relationship established through VPSC models, I predicted the strain for a number of quartz EBSD samples. 

I analysed the relationship of two anisotropy indices and conclude they can function as proxies for strain. I suggested a link to the texture indices, and hence potentially provide a remote measure of texture strength.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{leedsHarvard}
\bibliography{../dissertation}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\chapter{Appendix}
%\vspace{-1cm}
%TC:ignore
\newpage
\appendix
\renewcommand{\thesection}{\Roman{section}}
\chapter{Appendices}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Calculating the discrete M-index} \label{App:M-index_calc}
In this appendix I describe the detailed method for calculating the discrete M-index (function \texttt{m\_indexDisc}). I have refrained from including the entire code as it does not aid in the explanation and theory behind the algorithms, which is what I aim to do here. The code is available on the data disc included with this project, and also online\footnote{https://github.com/ee12lmb/TextureStrength}. In addition, there are extensive comments on both the function usage, and inside the code itself to make it easy to follow. The method is as follows. 

%\begin{itemize}
\subsubsection{Read data}
The input data is passed to \texttt{get\_inputInfo} which determines the data type (e.g. VPSC/EBSD/Euler angles) and returns $n$ randomly sampled sets Euler angles $\{\phi_1,\Phi,\phi_2\}$, as well as other meta data such as number of strain steps (where $n$ is the number of grains defined by the user).



\subsubsection{Theoretical misorientation angle distribution}
The \texttt{MTEX} function \texttt{calcAngleDistribution} provides the theoretical misorientation angle distribution when passed the crystal symmetry (which has been input by the user), which is defined for 300 angles evenly spaced between 0 and the theoretical maximum misorientation angle $\theta_{max}$. This distribution is then linearly interpolated and placed into appropriate bins based on the bin width entered (e.g. equation \ref{App:eq:nbins}). Care is taken here to ensure the \emph{area} of the histogram is correct as we are dealing with frequency densities.

\subsubsection{Sample misorientation angle distribution} 
The Euler angles extracted from the input texture are then passed to a function I wrote called \texttt{discreteMDF} to calculate the sample misorientation angle distribution. Firstly, the Euler angles are converted into an orientation matrix $g$ by:    
\begin{equation}
\begin{split}
g_{11} &= \cos{\phi_1}\cos{\phi_2} - \sin{\phi_1}\sin{\phi_2}\cos{\Phi} \\
g_{12} &= \sin{\phi_1}\cos{\phi_2} + \cos{\phi_1}\sin{\phi_2}\cos{\Phi} \\
g_{13} &= \sin{\phi_2}\sin{\Phi} \\
g_{21} &= -\cos{\phi_1}\sin{\phi_2} - \sin{\phi_1}\cos{\phi_2}\cos{\Phi} \\
g_{22} &= -\sin{\phi_1}\sin{\phi_2} + \cos{\phi_1}\cos{\phi_2}\cos{\Phi} \\
g_{23} &= \cos{\phi_2}\sin{\Phi} \\
g_{31} &= \sin{\phi_1}\sin{\Phi} \\
g_{32} &= -\cos{\phi_1}\sin{\Phi} \\
g_{33} &= \cos{\Phi}\ .
\end{split}
\end{equation}
\noindent
Following this the misorientation matrix $\tilde{g}$ is calculated by equation \ref{App:eq:misorientation} between all combinations of grains (see Appendix \ref{App:min_no_grains}).

For each misorietnation matrix $\tilde{g}$, the \emph{minimum} misorientation \citep[disorientation,][]{Grimmer1979} angle must be found. I wrote a function \texttt{calcDisorientation} that applies each of the $N$ symmetry operators for the chosen crystal (see Appendix \ref{App:symp_ops}) to each $\tilde{g}$ and calculates the misorientation angle for each $i$th symmetric equivalent by:   

\begin{equation}
\theta_i\ =\ \cos{}^{-1} \left( \frac{(\tilde{g}_{i,11} + \tilde{g}_{i,22} + \tilde{g}_{i,33} - 1)}{2}\ \right) ,
\end{equation}
\noindent
and takes the minimum $\displaystyle \min_{i...N}\{\theta_i\}$. The function \texttt{discreteMDF} then returns a list of disorientation angles, one for each pair of grains in the sample, to \texttt{m\_indexDisc}. 

\subsubsection{Binning and subtraction}
The disorientation angles are then placed into the same bins as the theoretical distribution. The relevant bins from each distribution are subtracted and the M-index calculated by:

\begin{equation}
M\ =\ \frac{\theta_{bin}}{2} \sum_{i=i}^{b_n} | f_i^R - f_i^M |\ ,  
\end{equation}
\noindent
where $\theta_{bin}$ is the bin width in degrees, $b_n$ is the total number of bins and $f^R$ and $f^M$ are the random and measured misorientation angle distributions respectively.
%\end{itemize}  

\section{Symmetry operators} \label{App:symp_ops}
In this appendix I give a brief definition of symmetry operators, and proceed to list those used in this project. Let the orientation of a crystal be defined by a rotation matrix $g$. There exists $N$ symmetry operators $S_i$ (also rotation matrices) that define rotations of the orientation $g$ to positions that are indistinguishable from its original orientation, due to the symmetry of the crystal, such that $g = gS_i$. Recalling a misorientation matrix $\tilde{g}$ between two grains $g_1$ and $g_2$ is defined such that,

\begin{equation}
g_2\ =\ \tilde{g}g_1\ ,
\end{equation} 
\noindent
and these two crystals described by orientations $g_1$ and $g_2$ have symmetry operators $S_i$ and $S_j$ respectively, we get:

\begin{equation} \label{App:eq:misorientation}
\tilde{g}\ =\ g_2g_1^{-1}\ = \tilde{g}(i,j)\ =\ g_2S_j(g_1S_i)^{-1}\ ,  
\end{equation}
\noindent
with $i,j \in [1...N]$. When calculating the misorientation angle from this matrix, \cite{Wheeler2001} prove that it is only necessary to consider $N$ symmetric variants when calculating a misorientation angle between two crystal, not all $N^2$ combinations --- this greatly increases efficiency.

The symmetry operation matrices for both olivine and post perovskite are (orthorhombic symmetry):


\begin{equation}
\begin{pmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 1 \\
\end{pmatrix}
\begin{pmatrix}
1 & 0 & 0 \\
0 & -1 & 0 \\
0 & 0 & -1 \\
\end{pmatrix}
\begin{pmatrix}
-1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & -1 \\
\end{pmatrix}
\begin{pmatrix}
-1 & 0 & 0 \\
0 & -1 & 0 \\
0 & 0 & 1 \\
\end{pmatrix}
\end{equation}

and for quartz:

\begin{equation}
\begin{multlined}
\begin{pmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 1 \\
\end{pmatrix}
\begin{pmatrix}
0.5    & -0.866 & 0 \\
-0.866 & -0.5   & 0 \\
0      & 0      & -1 \\
\end{pmatrix}
\begin{pmatrix}
-0.5    & -0.866 & 0 \\
0.866  & -0.5   & 0 \\
0      & 0      & 1 \\
\end{pmatrix}
\\
\begin{pmatrix}
-1 & 0 &  0 \\
0  & 1 &  0 \\
0  & 0 & -1 \\
\end{pmatrix}
\begin{pmatrix}
-0.5    & 0.866 & 0 \\
-0.866  & -0.5   & 0 \\
0      & 0      & 1 \\
\end{pmatrix}
\begin{pmatrix}
0.5    & 0.866 & 0 \\
0.866  & 0.5   & 0 \\
0      & 0      & -1 \\
\end{pmatrix}
\end{multlined}
\end{equation}
\noindent
taken from the \texttt{MTEX} function \texttt{crystalSymmetry} for quartz and \cite{Randle2000} for olivine.

\section{Interpolating for strain} \label{App:strain}
To find strain for a given index value, I used the data for the index-strain curves in Figure \ref{fig:indices_vs_strain} as reference curves. The function \texttt{get\_{}strain} takes either a path to an output data file from an \texttt{index} function (must be either EBSD or an \texttt{index\_{}repeat} output file), or a single index value. The algorithm is a simple linear interpolation.

\subsubsection{Data read}
If the data is a path to an output data file, extract the meta data from the headers to determine the crystal type (if not this has been supplied by the user) and index type, and read in the index value. If the data is just an index value, the user must define a crystal and index type. In both cases the user must specify whether the axial compression or simple shear reference curves should be used to determine strain. The strain type, crystal type and index type specify which reference curve is needed.

\subsubsection{Interpolation}
Loop over the reference curve to find the index values (and corresponding strains) that are either side of the input index value. Find the gradient between these points and use this to determine the strain at the input index value.


\section{Minimum number of grains (based on bin size)} \label{App:min_no_grains}
The formula for the number of pairs of grains $p_n$ (and therefore the number of misorientation angles) within a sample can be calculated as follows. First, let the number of grains in the sample be $n$. For the first grain there are $n - 1$ new pairs of grains (i.e. it is compared against all others in the sample). Moving to the second grain, there are $n - 2$ new pairs, as this grain has already been paired with the grain before it. The third grain will have $n - 3$ new pairs and so on resulting in:

\begin{equation}
p_n\ =\ (n-1) + (n-2) ... + (n - (n-1))\ =\ \sum_{i=1}^{n-1} (n - i)\ ,
\end{equation}   
\noindent
and, provided the sum is finite, this can be evaluated as:

\begin{equation}
p_n\ =\ \sum^{n-1}_{i=1}(n - i)\ =\ \frac{n}{2}(n-1)\ .
\end{equation}
\noindent
The number of bins $b_n$ can be calculated easily, provided the maximum theoretical misorientation angle $\theta_{max}$ and the bin width $\theta_{bin}$ are known:

\begin{equation} \label{App:eq:nbins}
b_n\ =\ \frac{\theta_{max}}{\theta_{bin}}\ ,
\end{equation}
\noindent
setting this equal with the previous equation and simplifying gives:

\begin{equation}
n^2\ -\ n\ -\ \frac{2\theta_{max}}{\theta_{bin}}\ =\ 0.
\end{equation}
\noindent
Solving this quadratic will give values for $n$, for which the positive value is taken and rounded up to provide an absolute minimum number of grains to give enough for one angle in each bin (which depends on crystal symmetry and bin size).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%% ADDITIONAL FIGURES %%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newpage
\section{Additional figures} \label{App:analysis_figs}
%---------------------------FIG---------------------------------------------   
This appendix contains figures that support the main text but have been omitted for the sake of clarity. Analysis figures have been omitted as similar conclusions can be drawn from figures in the text that were chosen to best illustrate the points made there. 
\\

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[h!]
  \centering
    \includegraphics[width=\textwidth]{figs/read_VPSC_speed.pdf}
  \caption[Read VPSC optimization]{Comparison of the time taken to read in VPSC files before and after the optimization of \texttt{read\_{}VPSC}. The test file had 26 time steps, with 10,000 grains in each. It is clear that the cumulative time for the pre-optimized curve goes as $O(N_s^2)$ where $N_s$ is the number of steps, whereas the optimized curve goes as $O(N_s)$. This effect is significant for larger files (almost two minutes in this case).}
  \label{fig:app:read_VPSC}
\end{figure} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[h!]
  \centering
    \includegraphics[width=\textwidth]{figs/EBSD_QTZ_std_conv.pdf}
  \caption[Index error with no. grains (quartz EBSD)]{Relationship between index standard deviation and number of grains used for index calculation, for quartz EBSD data. The data points are the standard deviation of 50 calculations, with $n$ randomly sampled grains for each calculation sampled with replacement. Calculations were ran for $n$ = 5, 10, 50, 100, 200, 500, 1,000, 2,000, 5,000 and 10,000. The panels show approximately increasing strain, shown by the pole figure numbers.}
  \label{fig:app:QTZ_EBSD_n_conv_err}
\end{figure}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[h!]
  \centering
    \includegraphics[width=\textwidth]{figs/MD_EBSD_n1000_distribution.pdf}
  \caption[Discrete M-index distribution (Quartz EBSD)]{Distribution of discrete M-index values. Histograms are composed from 1,000 calculations using $n$ = 1,000 grains (larger $n$ would require excessive compute time) from quartz EBSD data (shown by pole figure number). The distributions have been centred on zero by subtracting the mean from all values to allow for easier comparison between strain steps. It is clear the spread in index values becomes greater as strain increases.}
  \label{fig:app:MD_EBSD_dist}
\end{figure} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure*}[p]
  \centering
    \includegraphics[width=\textwidth]{figs/ALL_6panel_plot_DATAPOINTS.pdf}
  \caption[Relation of indices to strain (VPSC, with data points)]{Relationship between the J-index, continuous M-index and discrete M-index to sample strain, with data points to show curves are well constrained. Data are from VPSC models, with the indices calculated using the same 5,000 grains at each strain step. Discrete M-index calculated with a bin size of 0.25$^\circ$. \textbf{Top row} shows data for olivine, \textbf{middle row} shows quartz and \textbf{bottom row} shows post-perovskite (P-PS). \textbf{Left column} shows data from an axial compression VPSC model, the \textbf{right column} shows data from a simple shear VPSC model. Note the change of scale on both y-axes in \textbf{f}.}
  \label{fig:app:indices_vs_strain_DATAPOINTS}
\end{figure*} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{figure}[h!]
  \centering
    \includegraphics[width=\textwidth]{figs/EBSD_QTZ_n500_misor_dist.pdf}
  \caption[Misorientation angle distribution (quartz EBSD)]{Misorientation angle distributions for quartz EBSD data, calculated using the same 500 grains with a bin width of 1$^{\circ}$. The panels show pole figures of approximately increasing strain from \textbf{(a)}-\textbf{(b)}. The solid line shows the theoretical misorientation distribution for a random fabric of quartz grains. The red box indicates the potential numerical error.} 
  \label{fig:APP_misor_dist_qtz_ebsd}
\end{figure} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
\begin{figure}[h!]
  \centering
    \includegraphics[width=\textwidth]{figs/QTZ_AXC_n2000_misor_dist.pdf}
  \caption[Misorientation angle distribution (quartz VPSC, higher resolution)]{Misorientation angle distributions for a quartz VPSC model undergoing axial compression, calculated using the same 2000 grains with a bin width of 0.25$^{\circ}$. The panels show increasing strain with \textbf{(a)} 2\%, \textbf{(b)} 16\%, \textbf{(c)} 30\% and \textbf{(d)} 42\%. The solid line shows the theoretical misorientation distribution for a random fabric of quartz grains. The red box indicates the potential numerical error. Visualisation is difficult due to small bin width.} 
  \label{fig:app:quartz_VPSC_anomaly}
\end{figure} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\clearpage
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
\begin{figure}[h!]
  \centering
    \includegraphics[width=\textwidth]{figs/index_speed_comp.pdf}
  \caption[Index speed comparison]{Calculation speed comparison of all three indices for VPSC olivine. Each index was calculated for a single strain step, with $n$ = 5, 10, 100, 200, 500, 1,000, 2,000 and 5,000. Note the large difference in scales on the time axes.} 
  \label{fig:app:index_speed}
\end{figure} 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Example function output} \label{App:example_output}
\begin{texttt}
MD2\hspace{1cm}	     26\\
+Function:\hspace{1cm}      m\_indexDisc\\
+Time/date:\hspace{1cm}     16:57 23/3/2016\\
+Input file:\\    
+Crystal:\hspace{1cm}       post-perovskite\\
+Grains:\hspace{1cm}        5000 (bin size: 0.250000 degrees, binning: interp)\\
+Seed:\hspace{1cm}          1\\
+Time taken(s):\hspace{1cm} 3807.762166\\
+Columns:\hspace{1cm}       Strain,M-index\\
Data\\
   0.02000\hspace{1cm}    0.00350 \\
   0.04000\hspace{1cm}    0.00452 \\
   0.06000\hspace{1cm}    0.00621 \\
   0.08000\hspace{1cm}    0.00869 \\
   0.10000\hspace{1cm}    0.01216 \\
   0.12000\hspace{1cm}    0.01635 \\
   0.14000\hspace{1cm}    0.02135 \\
   0.16000\hspace{1cm}    0.02707 \\
   0.18000\hspace{1cm}    0.03354 \\
   0.20000\hspace{1cm}    0.04068 \\
   0.22000\hspace{1cm}    0.04850 \\
   0.24000\hspace{1cm}    0.05695 \\
   0.26000\hspace{1cm}    0.06603 \\
   0.28000\hspace{1cm}    0.07563 \\
   0.30000\hspace{1cm}    0.08583 \\
   0.32000\hspace{1cm}    0.09653 \\
   0.34000\hspace{1cm}    0.10764 \\
   0.36000\hspace{1cm}    0.11918 \\
   0.38000\hspace{1cm}    0.13109 \\
   0.40000\hspace{1cm}    0.14318 \\
   0.42000\hspace{1cm}    0.15548 \\
   0.44000\hspace{1cm}    0.16801 \\
   0.46000\hspace{1cm}    0.18063 \\
   0.48000\hspace{1cm}    0.19329 \\
   0.50000\hspace{1cm}    0.20592 \\
   0.50000\hspace{1cm}    0.20592 \\
\end{texttt}

%TC:endignore
\end{document}

