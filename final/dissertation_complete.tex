\documentclass[a4paper,12pt]{report}
\usepackage[left=2.5cm,right=1.7cm,bottom=2cm,top=2.2cm]{geometry}

% Page and title setup
\usepackage{setspace}
\setstretch{2}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead[CO,CE]{\leftmark}
\fancyhead[LO,LE]{SOEE3058}
\fancyhead[RE,RO]{200695089}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
\usepackage{titlesec}
\titleformat{\chapter}[display]
  {\normalfont\bfseries\vspace{-4.0cm}}{}{0pt}{\Huge}
\setcounter{secnumdepth}{2}
\usepackage[toc,page]{appendix}

% font
\usepackage{charter}    

% references
\usepackage{natbib} 
\bibliographystyle{leedsHarvard}  
\renewcommand\bibname{References}
  
% graphics and figures
\usepackage[font=it]{caption}
\usepackage{chngcntr}
\counterwithin{figure}{chapter}
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{graphicx}
\graphicspath{{/nfs/see-fs-01_teaching/ee12lmb/project/doc/figures/}}
\usepackage{tabularx}
\usepackage{tabulary}
\setlength\extrarowheight{10pt}

% program listings
\usepackage{float}
\newfloat{program}{thpb}{lop}
\floatname{program}{Listing}

\usepackage{color}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\usepackage{listings}
\lstset{language=Matlab,basicstyle=\small,keywordstyle=\color{black}\bfseri
es\underbar,
%identifierstyle=\color{red},
stringstyle=\ttfamily,
showstringspaces=false,
numbers=left, stepnumber=1,numberstyle=\tiny\color{gray},
keywordstyle=\color{blue},
commentstyle=\color{dkgreen},
stringstyle=\color{mauve},
morekeywords={m_indexDisc,m_indexCont,j_index}}

% equations
\usepackage{mathtools}  
\numberwithin{equation}{chapter}

% title etc
\title{\textbf{The M-index: A useful metric for rock deformation?}}
\author{Student: Lewis Bailey\\Student number: 200695089\\Supervisor: Dr Andrew Walker}
\date{}


\begin{document}
% -----------    D o c u m e n t     ------------
\maketitle

\tableofcontents

\listoffigures

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Introduction} \label{chap:intro}
\vspace{-1cm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%---------------------------------------------------------------------------
\section{Executive Summary} \label{sec:summary}
%---------------------------------------------------------------------------

%---------------------------------------------------------------------------
\section{Motivation} \label{sec:motivation}
%---------------------------------------------------------------------------
The study of textures and their strength has a number of applications in both industry and academia. Textures, or lattice preferred orientations (LPO) arise in rocks that have undergone ductile deformation. The properties of this LPO are dependant on the strain history, and in general increased strain leads to a \lq{}stronger\rq{} LPO \textbf{REF?}. If LPO strength can be quantified by a texture index, and this index can be reliably related to strain, then it could prove a useful tool in determining strain in situations where it is impossible to measure though conventional means.

This is especially applicable to mantle studies. Relating the formation and strength of textures in peridotites to shear strain is important, as this gives insight into how deformation mechanisms lead to seismic anisotropy \citep{Warren2008}. Understanding these processes is key in determining upper mantle convection through seismic anisotropy studies \citep[e.g.][]{Blackman2002}. A metric that can act as a proxy for texture strength would be beneficial to mantle studies, as most peridotites lack strain markers \citep{Tommasi2000}.

In addition to estimating strain from samples, texture indices could also offer a method of indirectly determining strain and other properties of textures via seismology. \cite{Tommasi1999} study the relationship between seismic anisotropy and LPO in continental deformation zones. They predict textures of olivine after undergoing various deformation types found in the mantle, and from this calculate the expected seismic anisotropy. If the remotely measured anisotropy can be related to texture strength (i.e. a texture index) and this index can be related to an amount of strain the material has experienced, it could provide at least an estimate of strain for remote regions of the Earth's interior. In essence this is the reverse of the processes used by \cite{Tommasi1999}. Although their study was applied to the mantle, seismic anisotropy due to LPO is known to exist in other regions of the Earth, and these have been studied using VPSC modelling \citep[e.g.][]{Wenk1999}.   

Aside from these general applications, a more direct motivation arises from \cite{Skemer}. After introducing their metric (the M-index) and applying it to olivine, they state that \lq\lq{}further research is necessary to confirm the M-index's validity or practicality for other materials\rq\rq{}, which gives clear scope for a project to investigate this. In order to confirm its validity, it is also necessary to compare the M-index with a number of other metrics in a similar fashion to \cite{Mainprice}, but with greater detail and for a number of crystal structures. This leads to the main aims and objectives of this study.   





%---------------------------------------------------------------------------
\section{Aims and objectives} \label{sec:aims+objs}
\noindent
\textbf{Aim:} to investigate a range of methods for determining the strength of rock texture.

\noindent	 
\textbf{Objectives;}
	\begin{itemize}
		\item Compile a suite of \texttt{Matlab} functions to compute the various methods of texture classification for a standardised input file. I will do this following coding principals \citep{Computing} using version control to keep track of the software development.
		\item Attempt to replicate some of \cite{Skemer} and \cite{Mainprice} for non-olivine samples to confirm or deny their observations are consistent across sample types.
		\item Calculate texture indexes for a range of samples and models and draw comparisons between the results. Determine the most robust and reliable method. Use texture strength as a proxy for shear strain and investigate correlations between this and the indexes calculated.
	\end{itemize}
%---------------------------------------------------------------------------

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Theory} \label{chap:theory}
\vspace{-1cm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The following sections aim to give enough theoretical knowledge of textures and the methods of computing texture strength, to allow understanding of the implementation and analysis that follows.


%---------------------------------------------------------------------------
\section{Textures in rocks} 
%---------------------------------------------------------------------------

%---------------------------------------------------------------------------
\section{Describing orientations} \label{sec:orientations}
%---------------------------------------------------------------------------
\emph{NB: The material in this section is covered by a number of textbooks on texture analysis, namely \cite{bunge1982texture} and \cite{Randle2000}}.




\subsection{Coordinate systems \& orientations} \label{subsec:coordinates}
The key principal behind describing the texture of a polycrystalline material is to be able to describe the orientations of the individual grains within it. In order to accomplish this two coordinates systems must be defined---one for the sample as a whole $(C_S)$ and one for any individual crystal within the sample $(C_C)$. Both systems should be Cartesian, with the directions of the axes usually chosen to best represent the important surfaces or directions within the sample to be studied. Once these two coordinate systems have been established, an orientation $(g)$ can then be defined to be a rotation that maps one coordinate system on to the other such that;



\begin{equation}
C_C\ =\ g \cdot C_S\ ,
\end{equation}  
\\
where in this case, the sample coordinate system is rotated to that of the crystal.




The orientation $g$ can be described in a number of ways. The principal method I will use is through \emph{Euler angles}. A set of Euler angles defines three rotations that transform the sample coordinate system onto the crystal coordinate system and so therefore specify an orientation. I will be using the conventions of \cite{bunge1982texture} such that the three rotation that make up the orientation are defined as $g = \{\varphi_1,\Phi,\varphi_2\}$. The angle $\varphi_1$ is the first rotation about the $Z$ axis, followed by a rotation $\Phi$ about the $X'$ axis in its new orientation, and finally $\varphi_2$ about the $Z''$ axis, in its final orientation (figure \ref{fig:euler_angles}). The order of these rotations is not interchangeable.




\begin{figure}[h!]
  \centering
    \includegraphics[width=0.6\textwidth]{euler_angles}
  \caption[Euler angle description]{Example of how the coordinate system of a sheet sample (here the $Z$ axis is in the normal direction ND and the $X$ axis is in the rolling direction RD) can be translated to that of the crystal coordinate system through three rotations $\varphi_1,\Phi,\varphi_2$. From \cite{Randle2000}.}
  \label{fig:euler_angles}
\end{figure}

Having established a method to describe an orientation (i.e. the rotation that maps sample to crystal coordinate systems or vice versa), so too can it describe a misorientation. A misorientation is defined as the rotation that maps one crystal's coordinate system onto another crystal's, rather than to the sample coordinate system (REF). This can be described for two orientations, $g_1$ and $g_2$ such that the misorientation between them $\tilde{g}$ is;

\begin{equation} \label{eq:misor_matrix}
\tilde{g} = g_1^{-1}g_2\ .
\end{equation} 

This notation for the misorientation becomes clearer with the introduction of an \emph{orientation matrix}. This is a nine element square rotation matrix constructed in the following way. Consider a crystal coordinate system $C_c = \{X_c,Y_c,Z_c\}$ and a sample coordinate system $C_s = \{X_s,Y_s,Z_s\}$. Then define angles between axes as follows;

\begin{table}[h!]
    \centering
	\begin{tabular}{c | c c c}

	  & $X_s$      & $Y_s$      & $Z_s$ \\
\hline
$X_c$ & $\alpha_1$ & $\beta_1$ & $\gamma_1$ \\
$Y_c$ & $\alpha_2$ & $\beta_2$ & $\gamma_2$ \\
$Z_c$ & $\alpha_3$ & $\beta_3$ & $\gamma_3$ \\

	\end{tabular}
\end{table}
\noindent
and so construct the matrix;

\begin{equation}
g = 
\begin{pmatrix}
g_{11} & g_{12} & g_{13} \\
g_{21} & g_{22} & g_{23} \\
g_{31} & g_{32} & g_{33} \\
\end{pmatrix}
= 
\begin{pmatrix}
cos \alpha_1 & cos \beta_1 & cos \gamma_1 \\
cos \alpha_2 & cos \beta_2 & cos \gamma_2 \\
cos \alpha_3 & cos \beta_3 & cos \gamma_3 \\
\end{pmatrix}\ .
\end{equation}
\\
This matrix is a useful tool in describing rotation and symmetry operations. Due to orthogonality $g^{-1} = g^T$. 



In addition to Euler angles and rotation matrices, another method for describing the orientation of a crystal, or indeed any number of crystals, in a sample is through the use of \emph{pole figures}. An orientation of an arbitrary crystal face (chosen to best represent the crystal structure) can be described by a vector normal to its surface. This vector, or pole, then corresponds to a point on a unit reference sphere with radius of 1 centred on the crystal (figure \ref{fig:spherical_orientation}). The reference sphere is attached to the sample coordinate system, allowing two angles (the azimuth $\alpha$ and the rotation around the pole axis $\beta$) to represent the orientation of the crystal with respect to that frame.  




\begin{figure}[h!]
  \centering
    \includegraphics[width=0.6\textwidth]{pole_figure}
  \caption[Pole figure visualisation]{Orientation of the basal (0001) plane in a hexagonal crystal. Projecting the orientation on the reference sphere requires two angles, $\alpha$ and $\beta$. In this example, the crystal still has freedom to rotate about the 0001 axis, so more information is required (the $\mathit{10\overline{1}0}$ pole) to describe the orientation in three dimensions. From \cite{Randle2000}.}
  \label{fig:spherical_orientation}
\end{figure}




In order to represent this three dimensional orientation in two dimensions, these poles must be projected onto a two-dimensional plane --- this is done using either stereographic or equal-area projection (the latter most common in geology). By choosing an axis of the sample coordinate system to be the north pole (typically $Z$) so that $\alpha = 0^\circ$ requires the normal of the plane in question to be parallel to that axis. The poles can then be projected as in figure \ref{fig:pole_olivine_example}, which shows an example of pole figures for a simulated olivine sample. Here the density of poles is plotted as a colour intensity. The Miller indicies above the figures show which crystal axes are being considered for each relevant pole figure. In the case of olivine and its cubic crystal shape, the poles of three crystal faces are needed to unambiguously describe its orientation. Any less than this and the crystal has a degree of freedom to rotate about the relevant axes, as in Figure \ref{fig:spherical_orientation}. 




\begin{figure}[h]
  \centering
    \includegraphics[width=0.85\textwidth,trim={3.2cm 10cm 0 0},clip]{poles_olivine_example}
  \caption[Pole figure olivine example]{Example of pole figures for a modelled olivine sample. The Miller indices are displayed above the the lower hemisphere projections.}
  \label{fig:pole_olivine_example}
\end{figure}




A pole figure represents the orientation of the crystal coordinate system in the sample coordinate system, but the opposite can also be useful, this is known as the inverse pole figure. In addition to pole figures, other methods of describing orientations exist such as rotation matrices \citep{bunge1982texture,Randle2000} and quaternions \citep{Quaternions}. However these are beyond the scope of this project. 




\subsection{Orientation distribution functions} \label{subsec:ODFs}
In order to perform quantitative analysis of a three dimensional texture in a sample, a two-dimensional pole figure does not contain enough information---a three-dimensional \emph{orientation distribution function} (ODF) is required. Unlike pole figures, ODFs cannot be measured experimentally, they must be calculated from pole figure data. Recalling that a pole direction can be defined by two angles $\alpha$ and $\beta$ in a pole figure $P_h(y)$, this then corresponds to a region in the ODF which contains all the rotations $\gamma$ about this direction $y$. This results in the following equation; 




\begin{equation} \label{eq:pole_figures}
P_h(y) = \frac{1}{2\pi} \cdot \int_{0}^{2\pi}f(g)\ \mathrm{d}\gamma;\ ,
\end{equation}
\\
where $f(g)$ is the ODF, with $g = \{\varphi_1,\Phi,\varphi_2\}$. In a similar way an inverse pole figure equation can also be derived. As pole figures are two-dimensional projections, multiple pole figures are needed in order to unambiguously describe the three-dimensional ODF.



Solving this equation is known as pole figure inversion, for which no analytic solution exists. One method for approximating the ODF is through spherical harmonic series expansion, such that;




\begin{equation} \label{eq:series_exp}
f(g) = \sum_{l=0}^{l_{max}} \sum_{m=-l}^l \sum_{n=-l}^l C_l^{mn} T_l^{mn} (g) \ ,
\end{equation}
\\
where $T_l^{mn}$ are spherical harmonic functions and $C_l^{mn}$ are expansion coefficients to be determined. Full description of this method \citep[][for detailed description]{bunge1982texture} and other, more direct methods \citep{Randle2000} is beyond the scope of this project.



Pole figure inversion deals with the practicality of obtaining an ODF from experimental pole figure data. However, \cite{bunge1982texture} offers a more intuitive description. Consider $\mathrm{d}V$ to be the volume of all crystals with orientation $g = \{\varphi_1,\Phi,\varphi_2\}$ within the infinitesimal volume element $\mathrm{d}g$ (in Euler space). It follows that;




\begin{equation}
\frac{\mathrm{d}V(g)}{V} = f(g)\ \mathrm{d}g\ ,
\end{equation}
\\
where $f(g)$ is the ODF, and $V$ is the total sample volume. \cite{Mainprice} state that a \emph{Mis}orientation Distribution Function (MDF) can be defined for a misorientation $\tilde{g}$ in a similar way;




\begin{equation}
\frac{\mathrm{d}V(\tilde{g})}{V} = f_{MDF}(\tilde{g})\ \mathrm{d}\tilde{g}\ ,
\end{equation}
\\
where $\mathrm{d}V(\tilde{g})/V$ is now the fraction of misorientations in the sample.


%---------------------------------------------------------------------------
\section{Texture indices} \label{sec:indicies}
%---------------------------------------------------------------------------
Having established a mathematical way of describing the orientations of grains within a sample (the ODF/MDF, herein referred to indiscriminately as the texture function), the next step is to find a method of quantising the \lq{}sharpness\rq{} or strength of a texture.

\subsection{J-index} \label{subsec:j-index}
 One of the longest standing indicies is the $J$ index, as described by \cite{bunge1982texture}, to be the integral of the square of the texture function,




\begin{equation}
J = \int [ f(g) ]^2\ \mathrm{d}g \ ,
\end{equation} 
\\
where the infinitesimal volume element in Euler angle space $\mathrm{d}g$ is given by,




\begin{equation}
\mathrm{d}g = \frac{1}{8\pi^2} \sin\Phi\ \mathrm{d}\Phi\ \mathrm{d}\varphi_1\ \mathrm{d}\varphi_2\ .
\end{equation} 
\\
This definition is true for both $f_{ODF}$ and $f_{MDF}$, the difference only being the definition of $g$ (section \ref{subsec:coordinates}). By substituting the series expansion for the ODF (eq. \ref{eq:series_exp})  and normalising, \cite{bunge1982texture} was able to determine that for a random texture $J_r = 1$. In addition, if the sample is a perfect single crystal, then the texture changes at only one point $g = g_0$, which results in $J_{ideal} \to \infty$, leading to,




\begin{equation}
1 \leq J_{ODF} \leq \infty\ .
\end{equation}
\\
$J_{MDF}$ will not tend to $\infty$ but rather a maximum value. Due to this index involving the square of $f(g)$, \cite{Mainprice} point out that this type of functional is called the $\mathrm{L^2}$-norm. 

In a nearly identical way, and by recalling the definition of pole figures (eq. \ref{eq:pole_figures}) the $J$ index can be defined as,
 
\begin{equation}
J_{P_h(y)} = \frac{1}{4\pi} \int [ P_{h}(y) ]^2\ dy\ ,
\end{equation}
\\
with the same holding true for inverse pole figures. By substituting in the series expansion for pole figures and through an integral calculus theorem \citep[p.90]{bunge1982texture} it can be shown that $J_{P_h(y)} \leq J$. This inequality makes sense physically in that the strength of texture in a pole figure cannot be greater than the strength of a texture as a whole, and can take a maximum value when the pole is aligned with the direction of the maximum texture. 


\subsection{M-index} \label{subsec:Mindex}
A more empirical method to quantify texture strength is the M-index. Defined by \cite{Skemer}, the method is based on the difference between a measured misorientation angle distribution $(f^M)$ and a random theoretic distribution $(f^R)$ (based on the sample crystal symmetry). In terms of continuous distribution functions, the index is;

\begin{equation} \label{eq:Mindex_cont}
M \equiv \frac{1}{2} \int | f^M(\theta) - f^R(\theta) |\ \mathrm{d}\theta \ .
\end{equation}  
\\   
However, for practical calculation it is easier to define it as;

\begin{equation} \label{eq:Mindex_disc}
M \equiv \sum_{i=1}^n | f_i^M - f_i^R | \cdot \frac{\theta_{max}}{2n}\ ,
\end{equation} 
where the calculation is now for $n$ bins and $\theta_{max}$ is the maximum theoretical misorientation angle for the specific crystal symmetry. The factor of a half is for convenience to give the range $0 \leq M \leq 1$. 

\textbf{GO OVER THIS SECTION AND ADD DETAIL/CRITICISM FROM THE LITERATURE}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Methods}
\vspace{-1cm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Now that the necessary theory has been established, the following sections provide a description of how the indices have been implemented. However, to understand the implementation it is important to first introduce the datasets from which the indices will be calculated.  

%---------------------------------------------------------------------------
\section{Data collection} \label{sec:data}
%---------------------------------------------------------------------------
The data in this project come from two sources; 1) numerical models of deformed polycrystalline aggregates and 2) direct texture measurements from physical specimens using electron backscatter diffraction. 

\subsection{VPSC modelling}
Viscoplastic self-consistent (VPSC) numerical modelling of LPO \citep{Molinari1987,Lebensohn1993} provides a very versatile dataset of textures to analyse. Using this technique, orientation data can be generated for a polycrystalline material with an entirely random texture, composed of crystals of a specified symmetry. This random texture can then be deformed in a number of ways (simple shear, axial compression etc.), the output of which is the set of Euler angles that describes the orientation of individual grains at time-steps throughout this designated deformation sequence (MAYBE FIG HERE?). Although a number of approaches exist to model polycrystalline deformation such as equilibrium based, purely kinematic or isotropic methods, VPSC is often used because of its robust physical assumptions and relatively quick computation \citep[][and references therein]{Tommasi2000}. 

Some key aspects that differentiate VPSC from other modelling regimes is that it accounts for plastic anisotropy (of both grain and matrix) as well as grain shape effects \citep[as introduced by][]{Lebensohn1993}. It differs from equilibrium based methods as microscopic stress and strain (i.e. for each grain) can vary, provided equilibrium is maintained at macroscopic scale \citep{Tommasi2000}. Effects of nearest neighbour interaction are not taken into account \citep[see][for details]{Castelnau1996}.

VPSC models were run by Dr Andrew Walker (University of Leeds) to provide a range of datasets as outlined in table \ref{tab:VPSC_data}. The output data file contains information such as the number of grains in the simulation and Euler angles for each grain, as well as the strain at each time step. This is the most useful aspect of VPSC modelling, as strain is always known accurately, which is often not the case for physical samples. However, one drawback is that as with any model, there will be elements of reality that are not accounted for and as such physical datasets are required for this project.

\begin{table} 
	\centering
	\caption[VPSC datasets]{Details of all datasets created using VPSC modelling. VPSC models ran by Dr Andrew Walker (University of Leeds).\\}
\begin{tabularx}{\textwidth}{X X X X}
	\hline
	\hline
	Crystal Type    & Deformation Type  & No. Grains & Name on Disk \\
	\hline
	\hline
	Olivine         & Axial Compression & 200        & *Needs completing *    \\
	Olivine         & Simple Shear      & 10,000     & *Needs completing*    \\
	Post-perovskite & Simple Shear      & 203,102    & *Needs completing*    \\
	\hline
	\end{tabularx}
\label{tab:VPSC_data}
\end{table}

\subsection{Electron backscatter diffraction}
X-ray techniques have long been used to study various properties of crystals and polycrystalline materials. A number of methods have arisen to determine crystal orientation data using a scanning electron microscope (SEM), including electron channeling patterns and X-ray Kossel-line techniques. However, these have been generally surpassed by electron backscatter diffraction \citep[EBSD or backscatter Kikuchi diffraction,][]{Harland1973}.  In essence, an electron beam is fired at a steeply tilted crystalline sample (to decrease path length for backscattered electrons), which produces distinctive backscatter Kikuchi patterns. These patterns are captured by a phosphor screen and digitised by a camera, and can then be analysed by software to determine crystal orientation information from their geometry  \citep{Zaefferer2007}. By moving the beam over the sample, the orientation information of all grains can be determined. \cite{Prior1999} offer a thorough description of the EBSD technique, specifically it use for rock texture, e.g. sample preparation. Further discussion of the technique is beyond the scope of this project \citep[see][]{Schwarzer1997,Randle2000}.    

Orientation data for a number of datasets was measured using EBSD... \textbf{discuss the actual sample sets used here - need to talk to Andrew.}

%---------------------------FIG---------------------------------------------   
\begin{figure}[h!]
  \centering
    \includegraphics[width=\textwidth]{EBSD_Pole_Figs.pdf}
  \caption[EBSD data (pole figures)]{A range of quartz c-axis CPO fabrics from the Annapurna-Dhaulagiri Himalaya. Contours shows multiples of uniform distribution. Maximum and minimum values of multiples of uniform distribution are next to each pole figure, with the sample number displayed beneath. The samples have been ordered qualitatively from the lowest strain (1) to the highest (10) by comparing pole figures with those in the literature. These pole figures and sample numbers represent the EBSD data that was used in this project \citep[made available from][]{ParsonsThesis}.}
  \label{fig:EBSD_data}
\end{figure}  
%---------------------------FIG---------------------------------------------   
    

%---------------------------------------------------------------------------
\section{Implementation}
%---------------------------------------------------------------------------
The following section provides a general overview as to how these data sources are combined with the theory outlined in chapter \ref{chap:theory} to calculate the texture indices. The two forms of data presented the first challenge, as they needed to be read in and converted to a consistent format. A number of functions were written to extract Euler angles (and other metadata) from both VPSC (edited from original code by Dr Andrew Walker - University of Leeds) and EBSD output files (using some code from *REF*) and store them in identical arrays in \texttt{Matlab} for further processing (first part of table \ref{tab:functions}). Having achieved this, relevant functions were then written to calculate the various indices from these lists of Euler angles describing the orientations of each grain in the sample (with other relevant information such as crystal symmetry). All index functions have similar syntax in their use as demonstrated in listing \ref{lst:calcIndices}, which shows function calls to calculate a number of indices for a VPSC input file within the \texttt{Matlab} environment. Although all functions (see table \ref{tab:functions}) can be used in \texttt{Matlab}, in practice most analysis was carried out in shell scripts to allow efficient batch running with many different inputs.   


\begin{program}[htbp] 
   \centering
   \begin{lstlisting}
% initialise MTEX and add paths to relevant functions
setup_env;   
   
% store file path to VPSC data
VPSC = '~/project/data/olivine_axial_compress_VPSC_big/TEX_PH1.OUT';

% call discrete M-index function and output to file
[ m_disc , strain ] = m_indexDisc(VPSC,1000,1,'crystal','olivine',...
                                'bin',1,'outfile','~/m_disc.out');

% call continuous M-index function and output to file
% don't require strain as it was retrieved by previous function
m_cont = m_indexCont(VPSC,1000,1,'crystal','olivine',...
                                        'outfile','~/m_cont.out');

% call J-index function and output to file
j = j_index(VPSC,1000,1,'crystal','olivine','outfile','~/j_ind.out');


 \end{lstlisting}
   \caption{Snippet of code to calculate the discrete M-index, continuous M-index and J-index using a VPSC input data file. All indices are calculated for the same 1000 grains, using olivine symmetry, with the output file names given after the \lq{}outfile\rq{} flag. The discrete M-index is calculated with a bin width of 1$^\circ$.}
   \label{lst:calcIndices}
\end{program}

Some elements of the code were optimised when it became apparent that significant computational time was being wasted due to inefficiencies. For example, the time taken to read in a data file using \texttt{read\_{}VPSC} would increase exponentially as more strain steps were added to the VPSC file. Due to the exceptionally large data files (e.g. 10,000 grains per strain increment, with 26 increments gives 260,000 grains total), it was necessary to modify the code so that the read time increased linearly (see ** APPENDIX REF **). 

While developing the software for this project,a number of scientific programming practices were followed --- namely those outlined by \cite{Wilson2014}. For example, extensive documentation is included within the functions themselves, including their usage but also references for relevant theory. In addition, version control software \texttt{Github} was used to track the development and also allow distribution of the code (full \texttt{Matlab} source code available from https://github.com/ee12lmb/matlabSource).

\subsection{J-index \& continuous M-index}
The majority of the tools required to calculated the J-index and continuous M-index are provided in the \texttt{MTEX} texture toolkit, built for use in \texttt{Matlab} \citep{Mainprice}. I wrote functions to pull together these tools and apply them to a range of inputs, with the ability to sub-sample input textures and specify parameters such as the number of grains used for the calculation. See APPENDIX REF for full listing of both functions, and details of their calculation.

\subsection{Discrete M-index}
The calculation of the discrete M-index is more involved than the other indices. Recalling the discrete form of the equation \citep[][equation \ref{eq:Mindex_disc}]{Skemer}, it is necessary to know the theoretical misorientation angle distribution for a random fabric (composed of crystals of a given symmetry) and that of the sample in order to calculate the index . The theoretical distribution can be retrieved passing a crystal symmetry to the \texttt{MTEX} function \texttt{calcAngleDistribution}. What is returned is a set of misorientation angles and the corresponding frequency density for each angle (FIG REF - olivine angle distribution). In order to calculate the distribution for the input sample texture, I wrote a function to find the misorientation matrix (equation \ref{eq:misor_matrix}) between every combination of grains in the sample. Each matrix then needs to be multiplied by all the symmetry operators for the given crystal structure in order to find the minimum misorientation angle \citep[sometimes called the disorientation, for details see *APPENDIX REF* and][]{Grimmer1979}. These misorientation angles and frequencies for the theoretical distribution and for that of the sample are then placed into bins of a fixed number of degrees in order to be subtracted. For details of this method and full listings of the relevant functions see (APPENDIX REF).     



\begin{table}[p!] 
	\centering
	\caption[VPSC datasets]{List of functions main functions with general descriptions. For more exhaustive documentation see in-function comments/appendices.}
	\noindent
	
\begin{tabularx}{\textwidth}{lX}

\hline
\hline
Function    & Description   \\ 
\hline
\hline

\texttt{setup\_{}env} & Function initialises the \texttt{MTEX} package and adds paths to all other functions. Stores a global variable to indicate this has been completed (to prevent this occurring at each separate function call). \\  

\texttt{read\_{}VPSC} & Will extract Euler angles and strain information from VPSC files, if output in Bunge convention. If multiple strain steps are present their information will be stored in a cell array (edited from original code by Dr Andrew Walker). \\ 

\texttt{sample\_{}VPSC} & Loads data using \texttt{read\_{}VPSC} and then returns $n$ randomly sampled grains (without replacement). \\  

\texttt{read\_{}EBSD} & Similar to \texttt{read\_{}VPSC}, but reads in EBSD files (*.ctf format). \\

\texttt{sample\_{}EBSD} & Similal to \texttt{sample\_{}VPSC} but for EBSD files (*.ctf format). \\ 
\\
\hline
\hline

\texttt{j\_{}index}$^{\dagger}$ & Calculates the J-index using elements of the \texttt{MTEX} package. \\ 

\texttt{m\_{}indexCont}$^{\dagger}$ & Calculates the continuous version of the M-index using elements of \texttt{MTEX} package. \\

\texttt{m\_{}indexDisc}$^{\dagger}$ & Calculates the discrete version of the M-index. \\

\texttt{discreteMDF} & Finds the misorientation angle distribution for a given dataset and crystal symmetry. For use in \texttt{m\_{}indexDisc}. \\

\texttt{calDisorientation} & Finds the minimum angle needed to rotate one crystal onto the other, given a crystal symmetry (for use in \texttt{discreteMDF}). \\
\\
\hline
\hline

\texttt{index\_{}repeat}$^{\dagger}$ & Will calculate any of the above indices a number of times (for a specific strain step), using a different seed to resample the data each time (\emph{with} replacement). \\

\texttt{read\_{}texout} & Will read data files output by all \texttt{index} functions. \\
\hline
& \footnotesize{$^\dagger$ \textit{Functions can take EBSD or VPSC files as input, and sample $n$ grains randomly without replacement for index calculation.}} \\

\end{tabularx}
\label{tab:functions}
\end{table}

%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Analysis}
\vspace{-1cm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
The assessment of the texture indices in this project can be broken down into two broad sections. By their definition it is expected the indices will be sensitive to strain, however it is first important to establish whether other parameters inherent in their calculation, such as the number of grains used, will affect their ouput \emph{(robustness)}. The aim is to determine what is necessary to find the \lq{}true\rq{}, or most accurate, index value of a given sample. Comparisons are drawn with results from the literature, particularly those of \cite{Skemer} as their motivation for creating the M-index was to provide a more robust measure of texture strength. After determining what criteria need to be met to produce an accurate index value, analysis of the relationship between strain and the indices \emph{(proxy for strain)} can be conducted with confidence that the values presented are accurate and representative of the given sample/model. Both the robustness of the indices and their use as a proxy for strain were studied using VPSC models and EBSD data from field samples (see section \ref{sec:data}) and as such, results for both are included in each section to support any conclusions from two independant data sources. The results presented here are chosen to best represent the numerous analyses conducted, and appendix references to additional results are provided when necessary.       


%---------------------------------------------------------------------------
\section{Index robustness}
%---------------------------------------------------------------------------
One of the first aspects to consider when calculating any texture index is the number of grains that will be used. An index might be considered robust if its value is independent of the number of grains input in the calculation (i.e. an index value calculated using 1,000 grains from a texture would be similar to the same index calculated using 100 grains from the same texture). However, an index will never be completely independent of the number of grains, but would be expected to converge to a certain value past a threshold. This is clear as a larger number of grains will be more representative of the texture as a whole, allowing for a more accurate index calculation. Figure \ref{fig:OLV_AXC_n_conv} demonstrates this for a VPSC model of olivine undergoing axial compression. 

%---------------------------FIG---------------------------------------------   
\begin{figure}[t!]
  \centering
    \includegraphics[width=\textwidth]{figs/OLV_AXC_Conv_INTERP}
  \caption[Convergence with no. grains (olivine VPSC)]{Convergence plots for J-index, continuous M-index and discrete M-index calculated for an olivine VPSC model undergoing axial compression. The panels show increasing strain steps with (a) 2\%, (b) 16\%,(c) 30\% and (d) 42\% strain. Each data point is the avaerage of 50 calculations, with $n$ randomly sampled grains from a total of 10,000 (sampled with replacement). Calculations were ran for $n$ = 5, 10, 50, 100, 200, 500, 1,000, 2,000, 5,000 and 10,000. Error bars are from the standard deviation of these 50 measurements. All indices show convergence to constant values for calculations that use approximately 1000 grains and above, with standard deviation decreasing rapidly as the number of grains is increased.}
  \label{fig:OLV_AXC_n_conv}
\end{figure}
%---------------------------FIG---------------------------------------------   


As expected, all indices show convergence as the number of grains used in their calculation increases. Both the J-index and the continuous M-index converge smoothly at similar rates, as they are both calculated statistically (**SECTION REF?**). At very low numbers of grains ($<$50) the discrete M-index value is many times greater than the converged value. This is inherent in the calculation of this index as it requires enough data to construct a histogram to represent the misorientation angle distribution of the texture, which will not be possible with low numbers of grains. Although the value is initially far from the converged value, the discrete M-index has a much higher rate of convergence that the other indices. This is similar to findings of \cite{Skemer} in that convergence is rapid, although they find this occurs at smaller numbers of grains. In contrast to \cite{Skemer}, this effect is more pronounced at higher strain rates, which can be seen when comparing (a) with (d) in figure \ref{fig:OLV_AXC_n_conv} (the discrete M-index curve has levelled at lower $n$ in (d)), although these data are calculated from a VPSC model and not EBSD data as in \cite{Skemer}.

%---------------------------FIG---------------------------------------------   
\begin{figure}[t!]
  \centering
    \includegraphics[width=\textwidth]{figs/EBSD_QTZ_n_Conv.pdf}
  \caption[Convergence with no. of grains (quartz EBSD)]{}
  \label{fig:EBSD_QTZ_n_conv}
\end{figure}
%---------------------------FIG---------------------------------------------   

In order to allow for this comparison, figure \ref{fig:EBSD_QTZ_n_conv} shows a similar convergence plot using quartz EBSD data (see section \ref{sec:data}). It is clear that the behaviour of the indices is very similar as $n$ is increased in this case, with all indices converging as low as $n = 500$. This supports the approximate threshold found using olivine VPSC data, using both real field data as well as crystals with  different symmetry. These results still differ from \cite{Skemer} who cite convergence as low as $n = 150$. 

      
%---------------------------FIG---------------------------------------------   
\begin{figure}[h!]
  \centering
    \includegraphics[width=\textwidth]{figs/OLV_AXC_std_conv_INTERP}
  \caption[Index error with no. grains (olivine)]{Relationship between index standard deviation and number of grains used for index calculation, for an olivine VPSC model undergoing axial compression. The data points are the standard deviation of 50 calculations, with $n$ randomly sampled grains for each calculation sampled with replacement from a VPSC model of 10,000 grains total. Calculations were ran for $n$ = 5, 10, 50, 100, 200, 500, 1,000, 2,000, 5,000 and 10,000. The panels show increasing strain with (a) 2\%, (b) 16\%, (c) 30\% and (d) 42\%. }
  \label{fig:OLV_AXC_n_conv_err}
\end{figure}
%---------------------------FIG---------------------------------------------


Having established how the indices converge it is also useful to know how the variability of each index will change with $n$, to give some idea of error bounds on individual calculations. To determine this, the indices were calculated 50 times for each value of $n$. For example, the data point for the continuous M-index at $n = 100$ grains was calculated 50 times, sub-sampling from a total of 10,000 grains (with replacement). The error bars on figures \ref{fig:OLV_AXC_n_conv} and \ref{fig:EBSD_QTZ_n_conv} are from the standard deviation $(\sigma)$ of these 50 calculations (with the plotted data point being the mean).

To further analyse this, $\sigma$ as a function of $n$ can be seen in figure \ref{fig:OLV_AXC_n_conv_err}. There is a clear trend of decreasing $\sigma$ as the number of grains is increased, although the benefit of increasing $n$ is reduced past approximately 1,000 grains, as $\sigma$ converges to a constant value (for all indices). This compliments the convergence threshold in that at $n >$ 1,000 all indices have converged to a \lq{}true\rq{} value, with the addition of the error being within acceptable bounds. The discrete M-index shows an anomalous drop in $\sigma$ at $n = 5$. This is again due to the need for enough grains to form a representative histogram of the misorientation distribution, and therefore when this distribution is so poorly defined the index will tend to produce similarly \lq{}wrong\rq{} values and so a smaller standard deviation will result.

%---------------------------FIG---------------------------------------------   
\begin{figure}[h!]
  \centering
    \includegraphics[width=\textwidth]{figs/OLV_AXC_bin_conv.pdf}
  \caption[Convergence with bin size (olivine)]{M-index convergence as bin size is decreased. The data are from analysis of an olivine VPSC model which has undergone axial compression. Each data point was calculated using the same 2,0000 grains, to ensure the indices calculated have converged (in terms of number of grains, see Fig. \ref{fig:OLV_AXC_n_conv}). Panels show increasing strain, with (a) 2\%, (b) 16\%, (c) 30\% and (d) 42\%. The grey line is the continuous M-index calculated for the same 2,000 grains for reference.}
  \label{fig:OLV_AXC_b_conv}
\end{figure}  
%---------------------------FIG---------------------------------------------   


%---------------------------------------------------------------------------
\section{Proxy for strain}
%---------------------------------------------------------------------------

%---------------------------FIG---------------------------------------------   
\begin{figure*}[p]
  \centering
    \includegraphics[width=\textwidth]{figs/ALL_6panel_plot.pdf}
  \caption[Relation of indices to strain (VPSC)]{Relationship between the J-index, continuous M-index and discrete M-index to sample strain. Data are from VPSC models, with the indices calculated using the same 5,000 grains at each strain step (this many grains ensures the results are in the convergent regime). Discrete M-index calculated with a bin size of 0.25$^\circ$. \textbf{Top row} shows data for olivine, \textbf{middle row} shows quartz and \textbf{bottom row} shows post-perovskite (P-PS). \textbf{Left column} shows data from an axial compression VPSC model, the \textbf{right column} shows data from a simple shear VPSC model. Note the change of scale on both y-axes in \textbf{f}. Applying these scales to other plots reduces clarity --- consistent scales on all other plots (within each column) allows for useful comparison (see text).}
  \label{fig:indices_vs_strain}
\end{figure*} 
%---------------------------FIG---------------------------------------------  


%---------------------------FIG---------------------------------------------   
\begin{figure}[h]
  \centering
    \includegraphics[width=\textwidth]{figs/QTZ_Strain_Zoom.pdf}
  \caption[Relation of indices to strain (quartz VPSC)]{Relationship between the indices and strain for quartz VPSC, calculated using the same 5,000 grains, with a bin size of 0.25$^\circ$ used for the discrete M-index calculation. Panels \textbf{(a)} and \textbf{(b)} use the same data as panels (c) and (d) in figure \ref{fig:indices_vs_strain}, with different scales to allow clearer analysis. In particular the strain axes for the simple shear VPSC has been restricted to 50\% (denser data points were used to ensure the curves are smooth and well defined). It is clear the discrete M-index does not follow the continuous M-index at low strains, and in fact increases as strain decreases below approximately 20\%.}
  \label{fig:indices_vs_strain_qtz}
\end{figure} 
%---------------------------FIG---------------------------------------------  

%---------------------------FIG---------------------------------------------   
\begin{figure}[h]
  \centering
    \includegraphics[width=\textwidth]{figs/QTZ_AXC_n500_misor_dist.pdf}
  \caption[Misorientation angle distribution (quartz)]{Misorientation angle distributions for a quartz VPSC model undergoing axial compression, calculated using the same 500 grains with a bin width of 0.25$^{\circ}$ ** maybe need more grains and smaller bin **. The panels show increasing strain with \textbf{(a)} XX, \textbf{(b)} XX, \textbf{(c)} XX and \textbf{(d)} XX. The solid line shows the theoretical misorientation distribution for a random fabric of quartz grains.} 
  \label{fig:qtz_misorientation_dist}
\end{figure} 
%---------------------------FIG---------------------------------------------  

%---------------------------FIG---------------------------------------------   
\begin{figure}[h]
  \centering
    \includegraphics[width=\textwidth]{figs/EBSD_ind-strain.pdf}
  \caption[Relationship of indices to strain (quartz EBSD)]{} 
  \label{fig:indices_vs_strain_qtz_EBSD}
\end{figure} 
%---------------------------FIG---------------------------------------------  

 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Discussion}
\vspace{-1cm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Conclusion}
\vspace{-1cm}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\chapter{Appendix}
%\vspace{-1cm}
\newpage
\appendix
\chapter{Appendices}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Calculating the discrete M-index}
The contents...


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{leedsHarvard}
\bibliography{../dissertation}
\end{document}
